<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--  This file is generated by Nim. -->
<html xmlns="https://www.w3.org/1999/xhtml" xml:lang="en" lang="en" data-theme="auto">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>src/mdlldk</title>

<!-- Favicon -->
<link rel="shortcut icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAUAAAAF////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAIAAABbAAAAlQAAAKIAAACbAAAAmwAAAKIAAACVAAAAWwAAAAL///8A////AP///wD///8A////AAAAABQAAADAAAAAYwAAAA3///8A////AP///wD///8AAAAADQAAAGMAAADAAAAAFP///wD///8A////AP///wAAAACdAAAAOv///wD///8A////AP///wD///8A////AP///wD///8AAAAAOgAAAJ3///8A////AP///wAAAAAnAAAAcP///wAAAAAoAAAASv///wD///8A////AP///wAAAABKAAAAKP///wAAAABwAAAAJ////wD///8AAAAAgQAAABwAAACIAAAAkAAAAJMAAACtAAAAFQAAABUAAACtAAAAkwAAAJAAAACIAAAAHAAAAIH///8A////AAAAAKQAAACrAAAAaP///wD///8AAAAARQAAANIAAADSAAAARf///wD///8AAAAAaAAAAKsAAACk////AAAAADMAAACcAAAAnQAAABj///8A////AP///wAAAAAYAAAAGP///wD///8A////AAAAABgAAACdAAAAnAAAADMAAAB1AAAAwwAAAP8AAADpAAAAsQAAAE4AAAAb////AP///wAAAAAbAAAATgAAALEAAADpAAAA/wAAAMMAAAB1AAAAtwAAAOkAAAD/AAAA/wAAAP8AAADvAAAA3gAAAN4AAADeAAAA3gAAAO8AAAD/AAAA/wAAAP8AAADpAAAAtwAAAGUAAAA/AAAA3wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAADfAAAAPwAAAGX///8A////AAAAAEgAAADtAAAAvwAAAL0AAADGAAAA7wAAAO8AAADGAAAAvQAAAL8AAADtAAAASP///wD///8A////AP///wD///8AAAAAO////wD///8A////AAAAAIcAAACH////AP///wD///8AAAAAO////wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A//8AAP//AAD4HwAA7/cAAN/7AAD//wAAoYUAAJ55AACf+QAAh+EAAAAAAADAAwAA4AcAAP5/AAD//wAA//8AAA=="/>
<link rel="icon" type="image/png" sizes="32x32" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH4QQQEwksSS9ZWwAAAk1JREFUWMPtll2ITVEUx39nn/O7Y5qR8f05wtCUUr6ZIS++8pEnkZInPImneaCQ5METNdOkeFBKUhMPRIkHKfEuUZSUlGlKPN2TrgfncpvmnntnmlEyq1Z7t89/rf9a6+y99oZxGZf/XeIq61EdtgKXgdXA0xrYAvBjOIF1AI9zvjcC74BSpndrJPkBWDScTF8Aa4E3wDlgHbASaANmVqlcCnwHvgDvgVfAJ+AikAAvgfVZwLnSVZHZaOuKoQi3ZOMi4NkYkpe1p4J7A8BpYAD49hfIy/oqG0+hLomiKP2L5L+1ubn5115S+3OAn4EnwBlgMzCjyt6ZAnQCJ4A7wOs88iRJHvw50HoujuPBoCKwHWiosy8MdfZnAdcHk8dxXFJ3VQbQlCTJvRBCGdRbD4M6uc5glpY3eAihpN5S5w12diSEcCCEcKUO4ljdr15T76ur1FDDLIQQ3qv71EdDOe3Kxj3leRXyk+pxdWnFWod6Wt2bY3de3aSuUHcPBVimHs7mK9WrmeOF6lR1o9qnzskh2ar2qm1qizpfXaPeVGdlmGN5pb09qMxz1Xb1kLqgzn1RyH7JUXW52lr5e/Kqi9qpto7V1atuUzfnARrV7jEib1T76gG2qxdGmXyiekkt1GswPTtek0aBfJp6YySGBfWg2tPQ0FAYgf1stUfdmdcjarbYJEniKIq6gY/Aw+zWHAC+p2labGpqiorFYgGYCEzN7oQdQClN07O1/EfDyGgC0ALMBdYAi4FyK+4H3gLPsxfR1zRNi+NP7nH5J+QntnXe5B5mpfQAAAAASUVORK5CYII=">

<!-- CSS -->
<link rel="stylesheet" type="text/css" href="nimdoc.out.css?v=2.1.1">

<!-- JS -->
<script type="text/javascript" src="dochack.js?v=2.1.1"></script>
</head>
<body>
  <div class="document" id="documentId">
    <div class="container">
      <h1 class="title">src/mdlldk</h1>
      <div class="row">
  <div class="three columns">
    <div class="theme-select-wrapper">
      <label for="theme-select">Theme:&nbsp;</label>
      <select id="theme-select" onchange="setTheme(this.value)">
        <option value="auto">ðŸŒ— Match OS</option>
        <option value="dark">ðŸŒ‘ Dark</option>
        <option value="light">ðŸŒ• Light</option>
      </select>
    </div>
    <div id="global-links">
      <ul class="simple">
        <li><a id="indexLink" href="theindex.html">Index</a></li>
      </ul>
    </div>
    <div id="searchInputDiv">
      Search: <input type="search" id="searchInput" oninput="search()"/>
    </div>
    <div>
      Group by:
      <select onchange="groupBy(this.value)">
        <option value="section">Section</option>
        <option value="type">Type</option>
      </select>
    </div>
    <ul class="simple simple-toc" id="toc-list">
  <li><a class="reference" id="basic-use_toc" href="#basic-use">Basic Use</a></li>
<li>
  <a class="reference reference-toplevel" href="#6" id="56">Imports</a>
</li>
<li>
  <details open>
    <summary><a class="reference reference-toplevel" href="#12" id="62">Procs</a></summary>
    <ul class="simple simple-toc-section">
      <ul class="simple nested-toc-section">addProcToExport
  <li><a class="reference" href="#addProcToExport%2Cstring%2Cint" title="addProcToExport(name: string; size: int)">addProcToExport(name: string; size: int)</a></li>

</ul>

    </ul>
  </details>
</li>
<li>
  <details open>
    <summary><a class="reference reference-toplevel" href="#18" id="68">Templates</a></summary>
    <ul class="simple simple-toc-section">
      <ul class="simple nested-toc-section">addAliasFor
  <li><a class="reference" href="#addAliasFor.t%2Cuntyped%2Cuntyped%2Cuntyped" title="addAliasFor(procName, aliasName, comments: untyped)">addAliasFor(procName, aliasName, comments: untyped)</a></li>

</ul>
<ul class="simple nested-toc-section">addLoadProc
  <li><a class="reference" href="#addLoadProc.t%2Cbool%2Cbool%2Cuntyped" title="addLoadProc(keepLoaded, strUnicode: bool; body: untyped)">addLoadProc(keepLoaded, strUnicode: bool; body: untyped)</a></li>

</ul>
<ul class="simple nested-toc-section">addUnloadProc
  <li><a class="reference" href="#addUnloadProc.t%2CUnloadReturn%2Cuntyped" title="addUnloadProc(unused: UnloadReturn; body: untyped)">addUnloadProc(unused: UnloadReturn; body: untyped)</a></li>

</ul>
<ul class="simple nested-toc-section">aliasFor
  <li><a class="reference" href="#aliasFor.t%2Cstring" title="aliasFor(procname: string = &quot;&quot;)">aliasFor(procname: string = &quot;&quot;)</a></li>

</ul>
<ul class="simple nested-toc-section">exportAllProcs
  <li><a class="reference" href="#exportAllProcs.t" title="exportAllProcs()">exportAllProcs()</a></li>

</ul>
<ul class="simple nested-toc-section">newProcToExport
  <li><a class="reference" href="#newProcToExport.t%2Cuntyped%2Cuntyped" title="newProcToExport(procname, body: untyped)">newProcToExport(procname, body: untyped)</a></li>

</ul>
<ul class="simple nested-toc-section">newProcToExportA
  <li><a class="reference" href="#newProcToExportA.t%2Cuntyped%2Cuntyped" title="newProcToExportA(procname, body: untyped)">newProcToExportA(procname, body: untyped)</a></li>

</ul>
<ul class="simple nested-toc-section">newProcToExportW
  <li><a class="reference" href="#newProcToExportW.t%2Cuntyped%2Cuntyped" title="newProcToExportW(procname, body: untyped)">newProcToExportW(procname, body: untyped)</a></li>

</ul>

    </ul>
  </details>
</li>

</ul>

  </div>
  <div class="nine columns" id="content">
    <a href="https://github.com/rockcavera/nim-mdlldk/tree/main/src/mdlldk.nim#L1" class="link-seesrc" target="_blank">Source</a>&nbsp;&nbsp;
<a href="https://github.com/rockcavera/nim-mdlldk/edit/main/src/mdlldk.nim#L1" class="link-seesrc" target="_blank" >Edit</a>&nbsp;&nbsp;

    <div id="tocRoot"></div>
    
    <p class="module-desc"><p>The mdlldk is a Dynamic-link libraries (DLLs) Development Kit for mIRC. The package brings templates that add the standard procedures of an mIRC dll, such as: LoadDll() and UnloadDll(); as well as facilitating the export of procedures, as it automatically creates the .def file with the symbols.</p>
<p>The package adds procedures that help in the development of your dll. All added procedures can be seen <a class="reference external" href="mdlldk/tools.html">here</a>.</p>
<p>The <tt class="docutils literal"><span class="pre"><span class="Identifier">newProcToExport</span><span class="Punctuation">(</span><span class="Punctuation">)</span></span></tt> template, which adds a procedure exported to dll and creates an entire abstraction to enable it to work in both unicode and non-unicode mIRC, that is, from version 5.6 (5.60), when support for dlls was added, up to the latest known version of mIRC. If you choose to use <tt class="docutils literal"><span class="pre"><span class="Identifier">newProcToExport</span><span class="Punctuation">(</span><span class="Punctuation">)</span></span></tt>, it will not be necessary to manually fill in the <tt class="docutils literal"><span class="pre"><span class="Identifier">data</span></span></tt> or <tt class="docutils literal"><span class="pre"><span class="Identifier">parms</span></span></tt> parameters, as this is done automatically, safely and without exceeding the size allocated by mIRC in the pointers and if it exceeds, it will be truncated to the limit and avoids mIRC crashes. This &quot;magic&quot; is done at runtime and according to each mIRC version, as the memory size allocated to the <tt class="docutils literal"><span class="pre"><span class="Identifier">data</span></span></tt> and <tt class="docutils literal"><span class="pre"><span class="Identifier">parms</span></span></tt> pointers has changed with the mIRC versions.</p>
<p>There are also the <tt class="docutils literal"><span class="pre"><span class="Identifier">newProcToExportW</span><span class="Punctuation">(</span><span class="Punctuation">)</span></span></tt> and <tt class="docutils literal"><span class="pre"><span class="Identifier">newProcToExportA</span><span class="Punctuation">(</span><span class="Punctuation">)</span></span></tt> templates, which also add an exported procedure to dll, but at a lower level than <tt class="docutils literal"><span class="pre"><span class="Identifier">newProcToExport</span><span class="Punctuation">(</span><span class="Punctuation">)</span></span></tt>. In the first template the parameters <tt class="docutils literal"><span class="pre"><span class="Identifier">data</span></span></tt> and <tt class="docutils literal"><span class="pre"><span class="Identifier">parms</span></span></tt> will be of type <tt class="docutils literal"><span class="pre"><span class="Identifier">WideCString</span></span></tt>, while in the second they will be <tt class="docutils literal"><span class="pre"><span class="Identifier">cstring</span></span></tt>. Even if you use one of these two templates you can also take advantage of safe copying to <tt class="docutils literal"><span class="pre"><span class="Identifier">data</span></span></tt> and <tt class="docutils literal"><span class="pre"><span class="Identifier">parms</span></span></tt> using <tt class="docutils literal"><span class="pre"><span class="Identifier">mToWideCStringAndCopy</span><span class="Punctuation">(</span><span class="Punctuation">)</span></span></tt> or <tt class="docutils literal"><span class="pre"><span class="Identifier">mToCStringAndCopy</span><span class="Punctuation">(</span><span class="Punctuation">)</span></span></tt>.</p>
<p>Add an alias to a procedure already declared with the <tt class="docutils literal"><span class="pre"><span class="Identifier">addAliasFor</span><span class="Punctuation">(</span><span class="Punctuation">)</span></span></tt> template.</p>
<p>Generate your dll documentation file using <tt class="docutils literal"><span class="pre"><span class="Identifier">nim</span> <span class="Identifier">doc</span></span></tt>. All documentation comments at the top of the body of calls to <tt class="docutils literal"><span class="pre"><span class="Identifier">addLoadProc</span><span class="Punctuation">(</span><span class="Punctuation">)</span></span></tt>, <tt class="docutils literal"><span class="pre"><span class="Identifier">addUnloadProc</span><span class="Punctuation">(</span><span class="Punctuation">)</span></span></tt>, <tt class="docutils literal"><span class="pre"><span class="Identifier">newProcToExport</span><span class="Punctuation">(</span><span class="Punctuation">)</span></span></tt>, <tt class="docutils literal"><span class="pre"><span class="Identifier">newProcToExportW</span><span class="Punctuation">(</span><span class="Punctuation">)</span></span></tt>, <tt class="docutils literal"><span class="pre"><span class="Identifier">newProcToExportA</span><span class="Punctuation">(</span><span class="Punctuation">)</span></span></tt> and <tt class="docutils literal"><span class="pre"><span class="Identifier">addAliasFor</span><span class="Punctuation">(</span><span class="Punctuation">)</span></span></tt> are passed to the documentation generated by Nim.</p>
<p>Finally, the <tt class="docutils literal"><span class="pre"><span class="Identifier">exportAllProcs</span><span class="Punctuation">(</span><span class="Punctuation">)</span></span></tt> template facilitates the process of exporting procedures to dll, as it generates the .def file with all the symbols that must be exported and links to the dll during the linking process. <tt class="docutils literal"><span class="pre"><span class="Identifier">exportAllProcs</span><span class="Punctuation">(</span><span class="Punctuation">)</span></span></tt> <strong>must be called at the end of your source code to work correctly</strong>.</p>
<p>For more information see the documentation below.</p>
<p><strong>Current support</strong></p>
<p>Currently supported with the gcc, clang and vcc compilers, and the C and C++ backends. It is advised to use the last version of Nim or the devel version.</p>
<p><strong>Documentation used as a reference</strong></p>
<ul class="simple"><li><a class="reference external" href="https://www.mirc.com/help/html/dll.html">https://www.mirc.com/help/html/dll.html</a></li>
<li><a class="reference external" href="https://www.mirc.com/versions.txt">https://www.mirc.com/versions.txt</a></li>
<li><a class="reference external" href="https://forum.nim-lang.org/t/8897">https://forum.nim-lang.org/t/8897</a></li>
</ul>

<h1><a class="toc-backref" id="basic-use" href="#basic-use">Basic Use</a></h1><p>This is a basic commented example:</p>
<p><pre class="listing">
<span class="Comment"># test.nim</span>
<span class="Comment"># Import the mdlldk package.</span>
<span class="Keyword">import</span> <span class="Identifier">pkg</span><span class="Operator">/</span><span class="Identifier">mdlldk</span>

<span class="Comment"># Adds procedure LoadDll().</span>
<span class="Identifier">addLoadProc</span><span class="Punctuation">(</span><span class="Identifier">false</span><span class="Punctuation">,</span> <span class="Identifier">true</span><span class="Punctuation">)</span><span class="Punctuation">:</span>
  <span class="Comment">## The dll will be unloaded right after use and the communication between</span>
  <span class="Comment">## mIRC and dll will be by the use of unicode strings.</span>
  <span class="Keyword">discard</span>

<span class="Comment"># Adds procedure UnloadDll().</span>
<span class="Identifier">addUnloadProc</span><span class="Punctuation">(</span><span class="Identifier">RAllowUnload</span><span class="Punctuation">)</span><span class="Punctuation">:</span>
  <span class="Comment">## The dll is allowed to unloaded.</span>
  <span class="Keyword">discard</span>

<span class="Comment"># Adds the `info` procedure, which can be called from mIRC.</span>
<span class="Identifier">newProcToExport</span><span class="Punctuation">(</span><span class="Identifier">info</span><span class="Punctuation">)</span><span class="Punctuation">:</span>
  <span class="Comment">## When called, it executes a command that prints a message about the dll</span>
  <span class="Comment">## in the active window.</span>
  <span class="Comment">##</span>
  <span class="Comment">## Usage: `/dll test.dll info`</span>
  <span class="Identifier">result</span><span class="Operator">.</span><span class="Identifier">outData</span> <span class="Operator">=</span> <span class="StringLit">&quot;echo -a test.dll made in Nim &quot;</span> <span class="Operator">&amp;</span> <span class="Identifier">NimVersion</span> <span class="Operator">&amp;</span> <span class="StringLit">&quot; for mIRC&quot;</span>
  <span class="Identifier">result</span><span class="Operator">.</span><span class="Identifier">ret</span> <span class="Operator">=</span> <span class="Identifier">RCommand</span>

<span class="Comment"># It must be added to the last line of your Nim code to correctly export all</span>
<span class="Comment"># symbols to the dll.</span>
<span class="Identifier">exportAllProcs</span><span class="Punctuation">(</span><span class="Punctuation">)</span></pre> The above code should be compiled as follows:</p>
<p><tt class="docutils literal"><span class="pre"><span class="Identifier">nim</span> <span class="Identifier">c</span> <span class="Operator">--</span><span class="Identifier">app</span><span class="Punctuation">:</span><span class="Identifier">lib</span> <span class="Operator">--</span><span class="Identifier">cpu</span><span class="Punctuation">:</span><span class="Identifier">i386</span> <span class="Operator">--</span><span class="Identifier">mm</span><span class="Punctuation">:</span><span class="Identifier">orc</span> <span class="Operator">--</span><span class="Identifier">noMain</span> <span class="Operator">-</span><span class="Identifier">d</span><span class="Punctuation">:</span><span class="Identifier">noRes</span> <span class="Operator">-</span><span class="Identifier">d</span><span class="Punctuation">:</span><span class="Identifier">useMalloc</span> <span class="Operator">-</span><span class="Identifier">d</span><span class="Punctuation">:</span><span class="Identifier">release</span> <span class="Identifier">test</span><span class="Operator">.</span><span class="Identifier">nim</span></span></tt></p>
<p>To learn more about compiler options, visit <a class="reference external" href="https://nim-lang.org/docs/nimc.html">https://nim-lang.org/docs/nimc.html</a>.</p>
<p>In case you want to produce a smaller dll, you can add such switches:</p>
<p><tt class="docutils literal"><span class="pre"><span class="Identifier">nim</span> <span class="Identifier">c</span> <span class="Operator">--</span><span class="Identifier">app</span><span class="Punctuation">:</span><span class="Identifier">lib</span> <span class="Operator">--</span><span class="Identifier">cpu</span><span class="Punctuation">:</span><span class="Identifier">i386</span> <span class="Operator">--</span><span class="Identifier">mm</span><span class="Punctuation">:</span><span class="Identifier">arc</span> <span class="Operator">--</span><span class="Identifier">noMain</span> <span class="Operator">-</span><span class="Identifier">d</span><span class="Punctuation">:</span><span class="Identifier">noRes</span> <span class="Operator">-</span><span class="Identifier">d</span><span class="Punctuation">:</span><span class="Identifier">useMalloc</span> <span class="Operator">-</span><span class="Identifier">d</span><span class="Punctuation">:</span><span class="Identifier">danger</span> <span class="Operator">-</span><span class="Identifier">d</span><span class="Punctuation">:</span><span class="Identifier">strip</span> <span class="Operator">-</span><span class="Identifier">d</span><span class="Punctuation">:</span><span class="Identifier">lto</span> <span class="Operator">--</span><span class="Identifier">threads</span><span class="Punctuation">:</span><span class="Identifier">off</span> <span class="Operator">--</span><span class="Identifier">opt</span><span class="Punctuation">:</span><span class="Identifier">size</span> <span class="Identifier">test</span><span class="Operator">.</span><span class="Identifier">nim</span></span></tt></p>
<p>With this last line my generated dll had only 11.5KB against 81,5KB of the other one, using the Nim 2.0.2 and clang 18.1.2 (i686-w64-windows-gnu) compilers.</p>
</p>
    <div class="section" id="6">
  <h1><a class="toc-backref" href="#6">Imports</a></h1>
  <dl class="item">
    <a class="reference external" href="mdlldk/dllmain.html">mdlldk/dllmain</a>, <a class="reference external" href="mdlldk/initnim.html">mdlldk/initnim</a>, <a class="reference external" href="mdlldk/tools.html">mdlldk/tools</a>, <a class="reference external" href="mdlldk/types.html">mdlldk/types</a>
  </dl>
</div>
<div class="section" id="12">
  <h1><a class="toc-backref" href="#12">Procs</a></h1>
  <dl class="item">
    <div id="addProcToExport-procs-all">
  <div id="addProcToExport,string,int">
  <dt><pre><span class="Keyword">proc</span> <a href="#addProcToExport%2Cstring%2Cint"><span class="Identifier">addProcToExport</span></a><span class="Other">(</span><span class="Identifier">name</span><span class="Other">:</span> <span class="Identifier">string</span><span class="Other">;</span> <span class="Identifier">size</span><span class="Other">:</span> <span class="Identifier">int</span><span class="Other">)</span> {.<span class="Identifier">compileTime</span><span class="Other">,</span> <span><span class="Other pragmadots">...</span></span><span class="pragmawrap"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span>
    <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">forbids</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span>.}</pre></dt>
  <dd>
    
    <p>Adds procedure <tt class="docutils literal"><span class="pre"><span class="Identifier">name</span></span></tt>, which has <tt class="docutils literal"><span class="pre"><span class="Identifier">size</span></span></tt> bytes in the parameter list, to be exported to the dll.</p>
<p><strong>Notes</strong></p>
<ul class="simple"><li>Procedures called by mIRC have 24 bytes in the parameter list.</li>
<li>Don't forget to call the <tt class="docutils literal"><span class="pre"><span class="Identifier">exportAllProcs</span><span class="Punctuation">(</span><span class="Punctuation">)</span></span></tt> template at the end of your Nim code.</li>
<li>Should not use this proc to add procedures created with <tt class="docutils literal"><span class="pre"><span class="Identifier">newProcToExport</span><span class="Punctuation">(</span><span class="Punctuation">)</span></span></tt>, <tt class="docutils literal"><span class="pre"><span class="Identifier">newProcToExportW</span><span class="Punctuation">(</span><span class="Punctuation">)</span></span></tt> and <tt class="docutils literal"><span class="pre"><span class="Identifier">newProcToExportA</span><span class="Punctuation">(</span><span class="Punctuation">)</span></span></tt>.</li>
</ul>

    <a href="https://github.com/rockcavera/nim-mdlldk/tree/main/src/mdlldk.nim#L249" class="link-seesrc" target="_blank">Source</a>&nbsp;&nbsp;
<a href="https://github.com/rockcavera/nim-mdlldk/edit/main/src/mdlldk.nim#L249" class="link-seesrc" target="_blank" >Edit</a>&nbsp;&nbsp;

  </dd>
</div>

</div>

  </dl>
</div>
<div class="section" id="18">
  <h1><a class="toc-backref" href="#18">Templates</a></h1>
  <dl class="item">
    <div id="addAliasFor-templates-all">
  <div id="addAliasFor.t,untyped,untyped,untyped">
  <dt><pre><span class="Keyword">template</span> <a href="#addAliasFor.t%2Cuntyped%2Cuntyped%2Cuntyped"><span class="Identifier">addAliasFor</span></a><span class="Other">(</span><span class="Identifier">procName</span><span class="Other">,</span> <span class="Identifier">aliasName</span><span class="Other">,</span> <span class="Identifier">comments</span><span class="Other">:</span> <span class="Identifier">untyped</span><span class="Other">)</span></pre></dt>
  <dd>
    
    <p>Adds an alias <tt class="docutils literal"><span class="pre"><span class="Identifier">aliasName</span></span></tt> to a procedure <tt class="docutils literal"><span class="pre"><span class="Identifier">procName</span></span></tt> already exported to the dll. <tt class="docutils literal"><span class="pre"><span class="Identifier">comments</span></span></tt> brings the body, in which you must place the documentation comment, which will be added when using <tt class="docutils literal"><span class="pre"><span class="Identifier">nim</span> <span class="Identifier">doc</span> <span class="Identifier">file</span><span class="Operator">.</span><span class="Identifier">nim</span></span></tt>.</p>
<p><pre class="listing">
<span class="Identifier">newProcToExport</span><span class="Punctuation">(</span><span class="Identifier">foo</span><span class="Punctuation">)</span><span class="Punctuation">:</span>
  <span class="Identifier">result</span><span class="Operator">.</span><span class="Identifier">outData</span> <span class="Operator">=</span> <span class="StringLit">&quot;OK&quot;</span>
  <span class="Identifier">result</span><span class="Operator">.</span><span class="Identifier">ret</span> <span class="Operator">=</span> <span class="Identifier">RReturn</span>

<span class="Identifier">addAliasFor</span><span class="Punctuation">(</span><span class="Identifier">foo</span><span class="Punctuation">,</span> <span class="Identifier">bar</span><span class="Punctuation">)</span><span class="Punctuation">:</span>
  <span class="Comment">## Is an alias for `foo`.</span></pre></p>

    <a href="https://github.com/rockcavera/nim-mdlldk/tree/main/src/mdlldk.nim#L578" class="link-seesrc" target="_blank">Source</a>&nbsp;&nbsp;
<a href="https://github.com/rockcavera/nim-mdlldk/edit/main/src/mdlldk.nim#L578" class="link-seesrc" target="_blank" >Edit</a>&nbsp;&nbsp;

  </dd>
</div>

</div>
<div id="addLoadProc-templates-all">
  <div id="addLoadProc.t,bool,bool,untyped">
  <dt><pre><span class="Keyword">template</span> <a href="#addLoadProc.t%2Cbool%2Cbool%2Cuntyped"><span class="Identifier">addLoadProc</span></a><span class="Other">(</span><span class="Identifier">keepLoaded</span><span class="Other">,</span> <span class="Identifier">strUnicode</span><span class="Other">:</span> <span class="Identifier">bool</span><span class="Other">;</span> <span class="Identifier">body</span><span class="Other">:</span> <span class="Identifier">untyped</span><span class="Other">)</span></pre></dt>
  <dd>
    
    Adds and exports the LoadDll() procedure, which is called when the dll is loaded in mIRC from version 5.8 onwards. In addition to adding the LoadDll() procedure, which captures and stores the information passed by mIRC to the dll, through the <tt class="docutils literal"><span class="pre"><span class="Identifier">LoadInfo</span></span></tt> object, it makes some corrections that facilitate the development of the dll, such as:<ul class="simple"><li>determine the total bytes value allocated to the <tt class="docutils literal"><span class="pre"><span class="Identifier">data</span></span></tt> and <tt class="docutils literal"><span class="pre"><span class="Identifier">parms</span></span></tt> parameters according to the mIRC version and string type (<tt class="docutils literal"><span class="pre"><span class="Identifier">WideCString</span></span></tt> or <tt class="docutils literal"><span class="pre"><span class="Identifier">cstring</span></span></tt>), since the <tt class="docutils literal"><span class="pre"><span class="Identifier">LoadInfo</span></span></tt> object did not always pass such information.</li>
<li>to correct and determine the version passed in the <tt class="docutils literal"><span class="pre"><span class="Identifier">mVersion</span></span></tt> field, of the <tt class="docutils literal"><span class="pre"><span class="Identifier">LoadInfo</span></span></tt> object, because in some versions the major version of mIRC was passed as 0 and after version 6.21 mIRC started to adopt the filling with zero to the right of the minor version, which was not done previously and caused ambiguity between versions.</li>
</ul>
<p><strong>Template parameters</strong></p>
<ul class="simple"><li><tt class="docutils literal"><span class="pre"><span class="Identifier">keepLoaded</span></span></tt> sets the <tt class="docutils literal"><span class="pre"><span class="Identifier">mKeep</span></span></tt> field of the <tt class="docutils literal"><span class="pre"><span class="Identifier">LoadInfo</span></span></tt> object, if possible. If it is <tt class="docutils literal"><span class="pre"><span class="Identifier">true</span></span></tt> it will keep the dll loaded after being called, however, if it is <tt class="docutils literal"><span class="pre"><span class="Identifier">false</span></span></tt>, the dll will be unloaded right after use. See <tt class="docutils literal"><span class="pre"><span class="Identifier">mKeep</span></span></tt> field in <a class="reference external" href="mdlldk/types.html#LoadInfo">LoadInfo</a>.</li>
<li><tt class="docutils literal"><span class="pre"><span class="Identifier">strUnicode</span></span></tt> sets the <tt class="docutils literal"><span class="pre"><span class="Identifier">mUnicode</span></span></tt> field of the <tt class="docutils literal"><span class="pre"><span class="Identifier">LoadInfo</span></span></tt> object, if possible. If it is <tt class="docutils literal"><span class="pre"><span class="Identifier">true</span></span></tt> the communication between mIRC and dll will be by the use of unicode strings (<tt class="docutils literal"><span class="pre"><span class="Identifier">WideCString</span></span></tt>), however, if it is <tt class="docutils literal"><span class="pre"><span class="Identifier">false</span></span></tt>, the communication will be by ANSI strings (<tt class="docutils literal"><span class="pre"><span class="Identifier">cstring</span></span></tt>). See <tt class="docutils literal"><span class="pre"><span class="Identifier">mUnicode</span></span></tt> field in <a class="reference external" href="mdlldk/types.html#LoadInfo">LoadInfo</a>.</li>
<li><tt class="docutils literal"><span class="pre"><span class="Identifier">body</span></span></tt> passes a code block that will be appended to the end of the LoadDll() procedure. If you didn't want to pass any code, use the <tt class="docutils literal"><span class="pre"><span class="Keyword">discard</span></span></tt> keyword.</li>
</ul>

    <a href="https://github.com/rockcavera/nim-mdlldk/tree/main/src/mdlldk.nim#L276" class="link-seesrc" target="_blank">Source</a>&nbsp;&nbsp;
<a href="https://github.com/rockcavera/nim-mdlldk/edit/main/src/mdlldk.nim#L276" class="link-seesrc" target="_blank" >Edit</a>&nbsp;&nbsp;

  </dd>
</div>

</div>
<div id="addUnloadProc-templates-all">
  <div id="addUnloadProc.t,UnloadReturn,untyped">
  <dt><pre><span class="Keyword">template</span> <a href="#addUnloadProc.t%2CUnloadReturn%2Cuntyped"><span class="Identifier">addUnloadProc</span></a><span class="Other">(</span><span class="Identifier">unused</span><span class="Other">:</span> <a href="mdlldk/types.html#UnloadReturn"><span class="Identifier">UnloadReturn</span></a><span class="Other">;</span> <span class="Identifier">body</span><span class="Other">:</span> <span class="Identifier">untyped</span><span class="Other">)</span></pre></dt>
  <dd>
    
    <p>Adds and exports the UnloadDll() procedure, which is called when mIRC unloads the dll from version 5.8 onwards.</p>
<p><strong>Template parameters</strong></p>
<ul class="simple"><li><tt class="docutils literal"><span class="pre"><span class="Identifier">unused</span></span></tt> determines if the dll will remain loaded or if it can be unloaded by mIRC when not in use for ten minutes. See <a class="reference external" href="mdlldk/types.html#UnloadReturn">UnloadReturn</a>.</li>
<li><tt class="docutils literal"><span class="pre"><span class="Identifier">body</span></span></tt> passes a code block that will be appended to the end of the UnloadDll() procedure. If you didn't want to pass any code, use the <tt class="docutils literal"><span class="pre"><span class="Keyword">discard</span></span></tt> keyword.</li>
</ul>
<p><strong>Notes</strong></p>
<ul class="simple"><li>The <tt class="docutils literal"><span class="pre"><span class="Identifier">result</span></span></tt> return variable is exposed and can be accessed and modified in <tt class="docutils literal"><span class="pre"><span class="Identifier">body</span></span></tt>.</li>
<li>The <tt class="docutils literal"><span class="pre"><span class="Identifier">mTimeout</span></span></tt> parameter is marked as <tt class="docutils literal"><span class="pre"><span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">inject</span><span class="Operator">.</span><span class="Punctuation">}</span></span></tt> and can be accessed in <tt class="docutils literal"><span class="pre"><span class="Identifier">body</span></span></tt>. Is of type <tt class="docutils literal"><span class="pre"><span class="Identifier">UnloadMode</span></span></tt>. See <a class="reference external" href="mdlldk/types.html#UnloadMode">UnloadMode</a>.</li>
</ul>

    <a href="https://github.com/rockcavera/nim-mdlldk/tree/main/src/mdlldk.nim#L324" class="link-seesrc" target="_blank">Source</a>&nbsp;&nbsp;
<a href="https://github.com/rockcavera/nim-mdlldk/edit/main/src/mdlldk.nim#L324" class="link-seesrc" target="_blank" >Edit</a>&nbsp;&nbsp;

  </dd>
</div>

</div>
<div id="aliasFor-templates-all">
  <div id="aliasFor.t,string">
  <dt><pre><span class="Keyword">template</span> <a href="#aliasFor.t%2Cstring"><span class="Identifier">aliasFor</span></a><span class="Other">(</span><span class="Identifier">procname</span><span class="Other">:</span> <span class="Identifier">string</span> <span class="Other">=</span> <span class="StringLit">&quot;&quot;</span><span class="Other">)</span> {.<span class="Identifier">pragma</span>.}</pre></dt>
  <dd>
    
    Annotates the alias procedure documentation with the pragma <tt class="docutils literal"><span class="pre"><span class="Identifier">aliasFor</span><span class="Punctuation">:</span> <span class="StringLit">&quot;procname&quot;</span></span></tt>, where <tt class="docutils literal"><span class="pre"><span class="Identifier">procname</span></span></tt> is the name of the aliased procedure.
    <a href="https://github.com/rockcavera/nim-mdlldk/tree/main/src/mdlldk.nim#L132" class="link-seesrc" target="_blank">Source</a>&nbsp;&nbsp;
<a href="https://github.com/rockcavera/nim-mdlldk/edit/main/src/mdlldk.nim#L132" class="link-seesrc" target="_blank" >Edit</a>&nbsp;&nbsp;

  </dd>
</div>

</div>
<div id="exportAllProcs-templates-all">
  <div id="exportAllProcs.t">
  <dt><pre><span class="Keyword">template</span> <a href="#exportAllProcs.t"><span class="Identifier">exportAllProcs</span></a><span class="Other">(</span><span class="Other">)</span></pre></dt>
  <dd>
    
    This template must be called at the end of your Nim code so that the .def file can be created with the name of all the procedures that must be exported to the dll.
    <a href="https://github.com/rockcavera/nim-mdlldk/tree/main/src/mdlldk.nim#L268" class="link-seesrc" target="_blank">Source</a>&nbsp;&nbsp;
<a href="https://github.com/rockcavera/nim-mdlldk/edit/main/src/mdlldk.nim#L268" class="link-seesrc" target="_blank" >Edit</a>&nbsp;&nbsp;

  </dd>
</div>

</div>
<div id="newProcToExport-templates-all">
  <div id="newProcToExport.t,untyped,untyped">
  <dt><pre><span class="Keyword">template</span> <a href="#newProcToExport.t%2Cuntyped%2Cuntyped"><span class="Identifier">newProcToExport</span></a><span class="Other">(</span><span class="Identifier">procname</span><span class="Other">,</span> <span class="Identifier">body</span><span class="Other">:</span> <span class="Identifier">untyped</span><span class="Other">)</span></pre></dt>
  <dd>
    
    <p>This template facilitates the creation of a new procedure, with the name <tt class="docutils literal"><span class="pre"><span class="Identifier">procname</span></span></tt>, to export to dll, as it creates an abstraction layer that makes it possible to work in unicode as well as non-unicode mIRC, that is, it allows for a retroportability up to the mIRC version 5.6, when dll support was added.</p>
<p>Also, in this case the <tt class="docutils literal"><span class="pre"><span class="Identifier">data</span></span></tt> parameter is of type <tt class="docutils literal"><span class="pre"><span class="Identifier">string</span></span></tt>, and the <tt class="docutils literal"><span class="pre"><span class="Identifier">show</span></span></tt> and <tt class="docutils literal"><span class="pre"><span class="Identifier">nopause</span></span></tt> parameters are of type <tt class="docutils literal"><span class="pre"><span class="Identifier">bool</span></span></tt>, providing better compatibility with Nim.</p>
<p>There is also no need to manipulate pointers to copy command and parameter return into <tt class="docutils literal"><span class="pre"><span class="Identifier">data</span></span></tt> and <tt class="docutils literal"><span class="pre"><span class="Identifier">parms</span></span></tt>, as this is done in the abstraction layer and truncates them, if necessary, to avoid crashing mIRC when the strings are longer than the allocated pointers.</p>
<p><strong>Template parameters</strong></p>
<ul class="simple"><li><tt class="docutils literal"><span class="pre"><span class="Identifier">procname</span></span></tt> is the name of the procedure that will be exported to the dll.</li>
<li><tt class="docutils literal"><span class="pre"><span class="Identifier">body</span></span></tt> passes a code block that will be attached to the internal procedure that is called by the <tt class="docutils literal"><span class="pre"><span class="Identifier">procname</span></span></tt> procedure.</li>
</ul>
<p><strong>The internal procedure</strong></p>
<p><pre class="listing">
<span class="Keyword">proc</span> <span class="Identifier">internalProc</span><span class="Punctuation">(</span><span class="Identifier">mWnd</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">inject</span><span class="Operator">.</span><span class="Punctuation">}</span><span class="Punctuation">,</span> <span class="Identifier">aWnd</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">inject</span><span class="Operator">.</span><span class="Punctuation">}</span><span class="Punctuation">:</span> <span class="Identifier">HWND</span><span class="Punctuation">,</span>
                  <span class="Identifier">data</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">inject</span><span class="Operator">.</span><span class="Punctuation">}</span><span class="Punctuation">:</span> <span class="Identifier">string</span><span class="Punctuation">,</span>
                  <span class="Identifier">show</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">inject</span><span class="Operator">.</span><span class="Punctuation">}</span><span class="Punctuation">,</span> <span class="Identifier">nopause</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">inject</span><span class="Operator">.</span><span class="Punctuation">}</span><span class="Punctuation">:</span> <span class="Identifier">bool</span><span class="Punctuation">)</span><span class="Punctuation">:</span>
                 <span class="Keyword">tuple</span><span class="Punctuation">[</span><span class="Identifier">ret</span><span class="Punctuation">:</span> <span class="Identifier">ProcReturn</span><span class="Punctuation">,</span> <span class="Identifier">outData</span><span class="Punctuation">,</span> <span class="Identifier">outParms</span><span class="Punctuation">:</span> <span class="Identifier">string</span><span class="Punctuation">]</span>
                 <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">nimcall</span><span class="Punctuation">,</span> <span class="Identifier">gensym</span><span class="Operator">.</span><span class="Punctuation">}</span> <span class="Operator">=</span>
  <span class="Identifier">body</span></pre> Parameters marked with <tt class="docutils literal"><span class="pre"><span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">inject</span><span class="Operator">.</span><span class="Punctuation">}</span></span></tt> are accessed through <tt class="docutils literal"><span class="pre"><span class="Identifier">body</span></span></tt>. See below the description of each parameter. Already the return value of the internal procedure is <tt class="docutils literal"><span class="pre"><span class="Keyword">tuple</span><span class="Punctuation">[</span><span class="Identifier">ret</span><span class="Punctuation">:</span> <span class="Identifier">ProcReturn</span><span class="Punctuation">,</span> <span class="Identifier">outData</span><span class="Punctuation">,</span> <span class="Identifier">outParms</span><span class="Punctuation">:</span> <span class="Identifier">string</span><span class="Punctuation">]</span></span></tt> and will be explained below.</p>
<p><strong>Parameters accessible in body</strong></p>
<ul class="simple"><li><tt class="docutils literal"><span class="pre"><span class="Identifier">mWnd</span></span></tt> is the handle to the main mIRC window. It is of type <tt class="docutils literal"><span class="pre"><span class="Identifier">HWND</span></span></tt>, which is a <tt class="docutils literal"><span class="pre"><span class="Identifier">int</span></span></tt>.</li>
<li><tt class="docutils literal"><span class="pre"><span class="Identifier">aWnd</span></span></tt> is the handle of the window in which the command is being issued, this might not be the currently active window if the command is being called by a remote script. It is of type <tt class="docutils literal"><span class="pre"><span class="Identifier">HWND</span></span></tt>, which is a <tt class="docutils literal"><span class="pre"><span class="Identifier">int</span></span></tt>.</li>
<li><tt class="docutils literal"><span class="pre"><span class="Identifier">data</span></span></tt> is the information sent to the dll. It is of type <tt class="docutils literal"><span class="pre"><span class="Identifier">string</span></span></tt>.</li>
<li><tt class="docutils literal"><span class="pre"><span class="Identifier">show</span></span></tt> is <tt class="docutils literal"><span class="pre"><span class="Identifier">false</span></span></tt> if the . prefix was specified to make the command quiet, or <tt class="docutils literal"><span class="pre"><span class="Identifier">true</span></span></tt> otherwise. It is of type <tt class="docutils literal"><span class="pre"><span class="Identifier">bool</span></span></tt>.</li>
<li><tt class="docutils literal"><span class="pre"><span class="Identifier">nopause</span></span></tt> is <tt class="docutils literal"><span class="pre"><span class="Identifier">true</span></span></tt> if mIRC is in a critical routine and the dll must not do anything that pauses processing in mIRC, eg. the dll should not pop up a dialog. It is of type <tt class="docutils literal"><span class="pre"><span class="Identifier">bool</span></span></tt>.</li>
</ul>
<p><strong>The fields of the internal procedure's return tuple</strong></p>
<ul class="simple"><li><tt class="docutils literal"><span class="pre"><span class="Identifier">ret</span></span></tt> indicates what mIRC should do. See <a class="reference external" href="mdlldk/types.html#ProcReturn">ProcReturn</a>.</li>
<li><tt class="docutils literal"><span class="pre"><span class="Identifier">outData</span></span></tt> can be filled in with a command you want mIRC to perform if any.</li>
<li><tt class="docutils literal"><span class="pre"><span class="Identifier">outParms</span></span></tt> can be filled in with the parameters you want mIRC to use when performing the command passed in <tt class="docutils literal"><span class="pre"><span class="Identifier">outData</span></span></tt>.</li>
</ul>

    <a href="https://github.com/rockcavera/nim-mdlldk/tree/main/src/mdlldk.nim#L398" class="link-seesrc" target="_blank">Source</a>&nbsp;&nbsp;
<a href="https://github.com/rockcavera/nim-mdlldk/edit/main/src/mdlldk.nim#L398" class="link-seesrc" target="_blank" >Edit</a>&nbsp;&nbsp;

  </dd>
</div>

</div>
<div id="newProcToExportA-templates-all">
  <div id="newProcToExportA.t,untyped,untyped">
  <dt><pre><span class="Keyword">template</span> <a href="#newProcToExportA.t%2Cuntyped%2Cuntyped"><span class="Identifier">newProcToExportA</span></a><span class="Other">(</span><span class="Identifier">procname</span><span class="Other">,</span> <span class="Identifier">body</span><span class="Other">:</span> <span class="Identifier">untyped</span><span class="Other">)</span></pre></dt>
  <dd>
    
    <p>This template makes it easy to create a new procedure to export to the dll, but at a lower level than <tt class="docutils literal"><span class="pre"><span class="Identifier">newProcToExport</span><span class="Punctuation">(</span><span class="Punctuation">)</span></span></tt>. In this case the <tt class="docutils literal"><span class="pre"><span class="Identifier">data</span></span></tt> and <tt class="docutils literal"><span class="pre"><span class="Identifier">parms</span></span></tt> parameters are of type <tt class="docutils literal"><span class="pre"><span class="Identifier">cstring</span></span></tt>.</p>
<p><strong>The `procname`</strong></p>
<p><pre class="listing">
<span class="Keyword">proc</span> <span class="Identifier">procname</span><span class="Punctuation">(</span><span class="Identifier">mWnd</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">inject</span><span class="Operator">.</span><span class="Punctuation">}</span><span class="Punctuation">,</span> <span class="Identifier">aWnd</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">inject</span><span class="Operator">.</span><span class="Punctuation">}</span><span class="Punctuation">:</span> <span class="Identifier">HWND</span><span class="Punctuation">,</span>
              <span class="Identifier">data</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">inject</span><span class="Operator">.</span><span class="Punctuation">}</span><span class="Punctuation">,</span> <span class="Identifier">parms</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">inject</span><span class="Operator">.</span><span class="Punctuation">}</span><span class="Punctuation">:</span> <span class="Identifier">cstring</span><span class="Punctuation">,</span>
              <span class="Identifier">show</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">inject</span><span class="Operator">.</span><span class="Punctuation">}</span><span class="Punctuation">,</span> <span class="Identifier">nopause</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">inject</span><span class="Operator">.</span><span class="Punctuation">}</span><span class="Punctuation">:</span> <span class="Identifier">BOOL</span><span class="Punctuation">)</span><span class="Punctuation">:</span>
             <span class="Identifier">ProcReturn</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">stdcall</span><span class="Punctuation">,</span> <span class="Identifier">exportc</span><span class="Operator">.</span><span class="Punctuation">}</span> <span class="Operator">=</span>
  <span class="Identifier">body</span></pre> Parameters marked with <tt class="docutils literal"><span class="pre"><span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">inject</span><span class="Operator">.</span><span class="Punctuation">}</span></span></tt> are accessed through <tt class="docutils literal"><span class="pre"><span class="Identifier">body</span></span></tt>. See below the description of each parameter. Already the return value is <tt class="docutils literal"><span class="pre"><span class="Identifier">ProcReturn</span></span></tt>. See <a class="reference external" href="mdlldk/types.html#ProcReturn">ProcReturn</a>.</p>
<p><strong>`procname` parameters</strong></p>
<ul class="simple"><li><tt class="docutils literal"><span class="pre"><span class="Identifier">mWnd</span></span></tt> is the handle to the main mIRC window. It is of type <tt class="docutils literal"><span class="pre"><span class="Identifier">HWND</span></span></tt>, which is a <tt class="docutils literal"><span class="pre"><span class="Identifier">int</span></span></tt>.</li>
<li><tt class="docutils literal"><span class="pre"><span class="Identifier">aWnd</span></span></tt> is the handle of the window in which the command is being issued, this might not be the currently active window if the command is being called by a remote script. It is of type <tt class="docutils literal"><span class="pre"><span class="Identifier">HWND</span></span></tt>, which is a <tt class="docutils literal"><span class="pre"><span class="Identifier">int</span></span></tt>.</li>
<li><tt class="docutils literal"><span class="pre"><span class="Identifier">data</span></span></tt> is the information that you wish to send to the dll. On return, the dll can fill this variable with the command it wants mIRC to perform if any. It is of type <tt class="docutils literal"><span class="pre"><span class="Identifier">cstring</span></span></tt>.</li>
<li><tt class="docutils literal"><span class="pre"><span class="Identifier">parms</span></span></tt> is filled by the dll on return with parameters that it wants mIRC to use when performing the command that it returns in the <tt class="docutils literal"><span class="pre"><span class="Identifier">data</span></span></tt> variable. It is of type <tt class="docutils literal"><span class="pre"><span class="Identifier">cstring</span></span></tt>.</li>
<li><tt class="docutils literal"><span class="pre"><span class="Identifier">show</span></span></tt> is FALSE (0) if the . prefix was specified to make the command quiet, or TRUE (1) otherwise. It is of type <tt class="docutils literal"><span class="pre"><span class="Identifier">BOOL</span></span></tt>, which is a <tt class="docutils literal"><span class="pre"><span class="Identifier">int32</span></span></tt>.</li>
<li><tt class="docutils literal"><span class="pre"><span class="Identifier">nopause</span></span></tt> is TRUE (1) if mIRC is in a critical routine and the dll must not do anything that pauses processing in mIRC, eg. the dll should not pop up a dialog. It is of type <tt class="docutils literal"><span class="pre"><span class="Identifier">BOOL</span></span></tt>, which is a <tt class="docutils literal"><span class="pre"><span class="Identifier">int32</span></span></tt>.</li>
</ul>

    <a href="https://github.com/rockcavera/nim-mdlldk/tree/main/src/mdlldk.nim#L526" class="link-seesrc" target="_blank">Source</a>&nbsp;&nbsp;
<a href="https://github.com/rockcavera/nim-mdlldk/edit/main/src/mdlldk.nim#L526" class="link-seesrc" target="_blank" >Edit</a>&nbsp;&nbsp;

  </dd>
</div>

</div>
<div id="newProcToExportW-templates-all">
  <div id="newProcToExportW.t,untyped,untyped">
  <dt><pre><span class="Keyword">template</span> <a href="#newProcToExportW.t%2Cuntyped%2Cuntyped"><span class="Identifier">newProcToExportW</span></a><span class="Other">(</span><span class="Identifier">procname</span><span class="Other">,</span> <span class="Identifier">body</span><span class="Other">:</span> <span class="Identifier">untyped</span><span class="Other">)</span></pre></dt>
  <dd>
    
    <p>This template makes it easy to create a new procedure to export to the dll, but at a lower level than <tt class="docutils literal"><span class="pre"><span class="Identifier">newProcToExport</span><span class="Punctuation">(</span><span class="Punctuation">)</span></span></tt>. In this case the <tt class="docutils literal"><span class="pre"><span class="Identifier">data</span></span></tt> and <tt class="docutils literal"><span class="pre"><span class="Identifier">parms</span></span></tt> parameters are of type <tt class="docutils literal"><span class="pre"><span class="Identifier">WideCString</span></span></tt>.</p>
<p><strong>The `procname` procedure</strong></p>
<p><pre class="listing">
<span class="Keyword">proc</span> <span class="Identifier">procname</span><span class="Punctuation">(</span><span class="Identifier">mWnd</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">inject</span><span class="Operator">.</span><span class="Punctuation">}</span><span class="Punctuation">,</span> <span class="Identifier">aWnd</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">inject</span><span class="Operator">.</span><span class="Punctuation">}</span><span class="Punctuation">:</span> <span class="Identifier">HWND</span><span class="Punctuation">,</span>
              <span class="Identifier">data</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">inject</span><span class="Operator">.</span><span class="Punctuation">}</span><span class="Punctuation">,</span> <span class="Identifier">parms</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">inject</span><span class="Operator">.</span><span class="Punctuation">}</span><span class="Punctuation">:</span> <span class="Identifier">WideCString</span><span class="Punctuation">,</span>
              <span class="Identifier">show</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">inject</span><span class="Operator">.</span><span class="Punctuation">}</span><span class="Punctuation">,</span> <span class="Identifier">nopause</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">inject</span><span class="Operator">.</span><span class="Punctuation">}</span><span class="Punctuation">:</span> <span class="Identifier">BOOL</span><span class="Punctuation">)</span><span class="Punctuation">:</span>
             <span class="Identifier">ProcReturn</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">stdcall</span><span class="Punctuation">,</span> <span class="Identifier">exportc</span><span class="Operator">.</span><span class="Punctuation">}</span> <span class="Operator">=</span>
  <span class="Identifier">body</span></pre> Parameters marked with <tt class="docutils literal"><span class="pre"><span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">inject</span><span class="Operator">.</span><span class="Punctuation">}</span></span></tt> are accessed through <tt class="docutils literal"><span class="pre"><span class="Identifier">body</span></span></tt>. See below the description of each parameter. Already the return value is <tt class="docutils literal"><span class="pre"><span class="Identifier">ProcReturn</span></span></tt>. See <a class="reference external" href="mdlldk/types.html#ProcReturn">ProcReturn</a>.</p>
<p><strong>`procname` parameters</strong></p>
<ul class="simple"><li><tt class="docutils literal"><span class="pre"><span class="Identifier">mWnd</span></span></tt> is the handle to the main mIRC window. It is of type <tt class="docutils literal"><span class="pre"><span class="Identifier">HWND</span></span></tt>, which is a <tt class="docutils literal"><span class="pre"><span class="Identifier">int</span></span></tt>.</li>
<li><tt class="docutils literal"><span class="pre"><span class="Identifier">aWnd</span></span></tt> is the handle of the window in which the command is being issued, this might not be the currently active window if the command is being called by a remote script. It is of type <tt class="docutils literal"><span class="pre"><span class="Identifier">HWND</span></span></tt>, which is a <tt class="docutils literal"><span class="pre"><span class="Identifier">int</span></span></tt>.</li>
<li><tt class="docutils literal"><span class="pre"><span class="Identifier">data</span></span></tt> is the information that you wish to send to the dll. On return, the dll can fill this variable with the command it wants mIRC to perform if any. It is of type <tt class="docutils literal"><span class="pre"><span class="Identifier">WideCString</span></span></tt>.</li>
<li><tt class="docutils literal"><span class="pre"><span class="Identifier">parms</span></span></tt> is filled by the dll on return with parameters that it wants mIRC to use when performing the command that it returns in the <tt class="docutils literal"><span class="pre"><span class="Identifier">data</span></span></tt> variable. It is of type <tt class="docutils literal"><span class="pre"><span class="Identifier">WideCString</span></span></tt>.</li>
<li><tt class="docutils literal"><span class="pre"><span class="Identifier">show</span></span></tt> is FALSE (0) if the . prefix was specified to make the command quiet, or TRUE (1) otherwise. It is of type <tt class="docutils literal"><span class="pre"><span class="Identifier">BOOL</span></span></tt>, which is a <tt class="docutils literal"><span class="pre"><span class="Identifier">int32</span></span></tt>.</li>
<li><tt class="docutils literal"><span class="pre"><span class="Identifier">nopause</span></span></tt> is TRUE (1) if mIRC is in a critical routine and the dll must not do anything that pauses processing in mIRC, eg. the dll should not pop up a dialog. It is of type <tt class="docutils literal"><span class="pre"><span class="Identifier">BOOL</span></span></tt>, which is a <tt class="docutils literal"><span class="pre"><span class="Identifier">int32</span></span></tt>.</li>
</ul>

    <a href="https://github.com/rockcavera/nim-mdlldk/tree/main/src/mdlldk.nim#L474" class="link-seesrc" target="_blank">Source</a>&nbsp;&nbsp;
<a href="https://github.com/rockcavera/nim-mdlldk/edit/main/src/mdlldk.nim#L474" class="link-seesrc" target="_blank" >Edit</a>&nbsp;&nbsp;

  </dd>
</div>

</div>

  </dl>
</div>

  </div>
</div>

      <div class="twelve-columns footer">
        <span class="nim-sprite"></span>
        <br>
        <small style="color: var(--hint);">Made with Nim. Generated: 2024-03-30 05:49:06 UTC</small>
      </div>
    </div>
  </div>
  
  <!-- Google fonts -->
  <link href='https://fonts.googleapis.com/css?family=Lato:400,600,900' rel='stylesheet' type='text/css'/>
  <link href='https://fonts.googleapis.com/css?family=Source+Code+Pro:400,500,600' rel='stylesheet' type='text/css'/>
</body>
</html>
