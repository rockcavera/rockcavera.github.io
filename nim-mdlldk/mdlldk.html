<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--  This file is generated by Nim. -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Favicon -->
<link rel="shortcut icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAUAAAAF////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAIAAABbAAAAlQAAAKIAAACbAAAAmwAAAKIAAACVAAAAWwAAAAL///8A////AP///wD///8A////AAAAABQAAADAAAAAYwAAAA3///8A////AP///wD///8AAAAADQAAAGMAAADAAAAAFP///wD///8A////AP///wAAAACdAAAAOv///wD///8A////AP///wD///8A////AP///wD///8AAAAAOgAAAJ3///8A////AP///wAAAAAnAAAAcP///wAAAAAoAAAASv///wD///8A////AP///wAAAABKAAAAKP///wAAAABwAAAAJ////wD///8AAAAAgQAAABwAAACIAAAAkAAAAJMAAACtAAAAFQAAABUAAACtAAAAkwAAAJAAAACIAAAAHAAAAIH///8A////AAAAAKQAAACrAAAAaP///wD///8AAAAARQAAANIAAADSAAAARf///wD///8AAAAAaAAAAKsAAACk////AAAAADMAAACcAAAAnQAAABj///8A////AP///wAAAAAYAAAAGP///wD///8A////AAAAABgAAACdAAAAnAAAADMAAAB1AAAAwwAAAP8AAADpAAAAsQAAAE4AAAAb////AP///wAAAAAbAAAATgAAALEAAADpAAAA/wAAAMMAAAB1AAAAtwAAAOkAAAD/AAAA/wAAAP8AAADvAAAA3gAAAN4AAADeAAAA3gAAAO8AAAD/AAAA/wAAAP8AAADpAAAAtwAAAGUAAAA/AAAA3wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAADfAAAAPwAAAGX///8A////AAAAAEgAAADtAAAAvwAAAL0AAADGAAAA7wAAAO8AAADGAAAAvQAAAL8AAADtAAAASP///wD///8A////AP///wD///8AAAAAO////wD///8A////AAAAAIcAAACH////AP///wD///8AAAAAO////wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A//8AAP//AAD4HwAA7/cAAN/7AAD//wAAoYUAAJ55AACf+QAAh+EAAAAAAADAAwAA4AcAAP5/AAD//wAA//8AAA=="/>
<link rel="icon" type="image/png" sizes="32x32" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH4QQQEwksSS9ZWwAAAk1JREFUWMPtll2ITVEUx39nn/O7Y5qR8f05wtCUUr6ZIS++8pEnkZInPImneaCQ5METNdOkeFBKUhMPRIkHKfEuUZSUlGlKPN2TrgfncpvmnntnmlEyq1Z7t89/rf9a6+y99oZxGZf/XeIq61EdtgKXgdXA0xrYAvBjOIF1AI9zvjcC74BSpndrJPkBWDScTF8Aa4E3wDlgHbASaANmVqlcCnwHvgDvgVfAJ+AikAAvgfVZwLnSVZHZaOuKoQi3ZOMi4NkYkpe1p4J7A8BpYAD49hfIy/oqG0+hLomiKP2L5L+1ubn5115S+3OAn4EnwBlgMzCjyt6ZAnQCJ4A7wOs88iRJHvw50HoujuPBoCKwHWiosy8MdfZnAdcHk8dxXFJ3VQbQlCTJvRBCGdRbD4M6uc5glpY3eAihpN5S5w12diSEcCCEcKUO4ljdr15T76ur1FDDLIQQ3qv71EdDOe3Kxj3leRXyk+pxdWnFWod6Wt2bY3de3aSuUHcPBVimHs7mK9WrmeOF6lR1o9qnzskh2ar2qm1qizpfXaPeVGdlmGN5pb09qMxz1Xb1kLqgzn1RyH7JUXW52lr5e/Kqi9qpto7V1atuUzfnARrV7jEib1T76gG2qxdGmXyiekkt1GswPTtek0aBfJp6YySGBfWg2tPQ0FAYgf1stUfdmdcjarbYJEniKIq6gY/Aw+zWHAC+p2labGpqiorFYgGYCEzN7oQdQClN07O1/EfDyGgC0ALMBdYAi4FyK+4H3gLPsxfR1zRNi+NP7nH5J+QntnXe5B5mpfQAAAAASUVORK5CYII=">

<!-- Google fonts -->
<link href='https://fonts.googleapis.com/css?family=Lato:400,600,900' rel='stylesheet' type='text/css'/>
<link href='https://fonts.googleapis.com/css?family=Source+Code+Pro:400,500,600' rel='stylesheet' type='text/css'/>

<!-- CSS -->
<title>src/mdlldk</title>
<link rel="stylesheet" type="text/css" href="nimdoc.out.css">

<script type="text/javascript" src="dochack.js"></script>

<script type="text/javascript">
function main() {
  var pragmaDots = document.getElementsByClassName("pragmadots");
  for (var i = 0; i < pragmaDots.length; i++) {
    pragmaDots[i].onclick = function(event) {
      // Hide tease
      event.target.parentNode.style.display = "none";
      // Show actual
      event.target.parentNode.nextElementSibling.style.display = "inline";
    }
  }

  function switchTheme(e) {
      if (e.target.checked) {
          document.documentElement.setAttribute('data-theme', 'dark');
          localStorage.setItem('theme', 'dark');
      } else {
          document.documentElement.setAttribute('data-theme', 'light');
          localStorage.setItem('theme', 'light');
      }
  }

  const toggleSwitch = document.querySelector('.theme-switch input[type="checkbox"]');
  if (toggleSwitch !== null) {
    toggleSwitch.addEventListener('change', switchTheme, false);
  }

  var currentTheme = localStorage.getItem('theme');
  if (!currentTheme && window.matchMedia('(prefers-color-scheme: dark)').matches) {
    currentTheme = 'dark';
  }
  if (currentTheme) {
    document.documentElement.setAttribute('data-theme', currentTheme);

    if (currentTheme === 'dark' && toggleSwitch !== null) {
      toggleSwitch.checked = true;
    }
  }
}

window.addEventListener('DOMContentLoaded', main);
</script>

</head>
<body>
<div class="document" id="documentId">
  <div class="container">
    <h1 class="title">src/mdlldk</h1>
    <div class="row">
  <div class="three columns">
  <div class="theme-switch-wrapper">
    <label class="theme-switch" for="checkbox">
      <input type="checkbox" id="checkbox" />
      <div class="slider round"></div>
    </label>
    &nbsp;&nbsp;&nbsp; <em>Dark Mode</em>
  </div>
  <div id="global-links">
    <ul class="simple">
    <li>
      <a href="theindex.html">Index</a>
    </li>
    </ul>
  </div>
  <div id="searchInputDiv">
    Search: <input type="text" id="searchInput"
      onkeyup="search()" />
  </div>
  <div>
    Group by:
    <select onchange="groupBy(this.value)">
      <option value="section">Section</option>
      <option value="type">Type</option>
    </select>
  </div>
  <ul class="simple simple-toc" id="toc-list">
<li><a class="reference" id="basic-use_toc" href="#basic-use">Basic Use</a></li>
<li>
  <a class="reference reference-toplevel" href="#6" id="56">Imports</a>
  <ul class="simple simple-toc-section">
    
  </ul>
</li>
<li>
  <a class="reference reference-toplevel" href="#12" id="62">Procs</a>
  <ul class="simple simple-toc-section">
      <ul class="simple nested-toc-section">addProcToExport
      <li><a class="reference" href="#addProcToExport%2Cstring%2Cint"
    title="addProcToExport(name: string; size: int)">addProcToExport(name: string; size: int)</a></li>

  </ul>

  </ul>
</li>
<li>
  <a class="reference reference-toplevel" href="#18" id="68">Templates</a>
  <ul class="simple simple-toc-section">
      <ul class="simple nested-toc-section">addLoadProc
      <li><a class="reference" href="#addLoadProc.t%2Cbool%2Cbool%2Cuntyped"
    title="addLoadProc(keepLoaded, strUnicode: bool; body: untyped)">addLoadProc(keepLoaded, strUnicode: bool; body: untyped)</a></li>

  </ul>
  <ul class="simple nested-toc-section">addUnloadProc
      <li><a class="reference" href="#addUnloadProc.t%2CUnloadReturn%2Cuntyped"
    title="addUnloadProc(unused: UnloadReturn; body: untyped)">addUnloadProc(unused: UnloadReturn; body: untyped)</a></li>

  </ul>
  <ul class="simple nested-toc-section">exportAllProcs
      <li><a class="reference" href="#exportAllProcs.t"
    title="exportAllProcs()">exportAllProcs()</a></li>

  </ul>
  <ul class="simple nested-toc-section">newProcToExport
      <li><a class="reference" href="#newProcToExport.t%2Cuntyped%2Cuntyped"
    title="newProcToExport(procname, body: untyped)">newProcToExport(procname, body: untyped)</a></li>

  </ul>
  <ul class="simple nested-toc-section">newProcToExportA
      <li><a class="reference" href="#newProcToExportA.t%2Cuntyped%2Cuntyped"
    title="newProcToExportA(procname, body: untyped)">newProcToExportA(procname, body: untyped)</a></li>

  </ul>
  <ul class="simple nested-toc-section">newProcToExportW
      <li><a class="reference" href="#newProcToExportW.t%2Cuntyped%2Cuntyped"
    title="newProcToExportW(procname, body: untyped)">newProcToExportW(procname, body: untyped)</a></li>

  </ul>

  </ul>
</li>
<li>
  <a class="reference reference-toplevel" href="#19" id="69">Exports</a>
  <ul class="simple simple-toc-section">
    
  </ul>
</li>

</ul>

  </div>
  &nbsp;&nbsp;<a
href="https://github.com/rockcavera/nim-mdlldk/tree/main/src/mdlldk.nim#L1"
class="link-seesrc" target="_blank">Source</a>
&nbsp;&nbsp;<a href="https://github.com/rockcavera/nim-mdlldk/edit/main/src/mdlldk.nim#L1" class="link-seesrc" target="_blank" >Edit</a>

  <div class="nine columns" id="content">
  <div id="tocRoot"></div>
  
  <p class="module-desc"><p>The mdlldk is a Dynamic-link libraries (DLLs) Development Kit for mIRC. The package brings templates that add the standard procedures of an mIRC dll, such as: LoadDll() and UnloadDll(); as well as facilitating the export of procedures, as it automatically creates the .def file with the symbols.</p>
<p>When exporting the LoadDll() procedure with the <tt class="docutils literal"><span class="pre"><span class="Identifier">addLoadProc</span><span class="Punctuation">(</span><span class="Punctuation">)</span></span></tt> template, procedures will be added that help in the development of your dll.</p>
<p>There is also the <tt class="docutils literal"><span class="pre"><span class="Identifier">newProcToExport</span><span class="Punctuation">(</span><span class="Punctuation">)</span></span></tt> template, which adds a procedure exported to dll and creates an entire abstraction to enable it to work in both unicode and non-unicode mIRC, that is, from version 5.6 (5.60), when support for dlls was added , up to the latest known version of mIRC. If you choose to use <tt class="docutils literal"><span class="pre"><span class="Identifier">newProcToExport</span><span class="Punctuation">(</span><span class="Punctuation">)</span></span></tt>, it will not be necessary to manually fill in the <tt class="docutils literal"><span class="pre"><span class="Identifier">data</span></span></tt> or <tt class="docutils literal"><span class="pre"><span class="Identifier">parms</span></span></tt> parameters, as this is done automatically, safely and without exceeding the size allocated by mIRC in the pointers. If it exceeds, it will be truncated to the limit. This avoids mIRC crashes. This &quot;magic&quot; is done at runtime and according to each mIRC version, as the memory size allocated to the <tt class="docutils literal"><span class="pre"><span class="Identifier">data</span></span></tt> and <tt class="docutils literal"><span class="pre"><span class="Identifier">parms</span></span></tt> pointers has changed with the mIRC versions.</p>
<p>There are also the <tt class="docutils literal"><span class="pre"><span class="Identifier">newProcToExportW</span><span class="Punctuation">(</span><span class="Punctuation">)</span></span></tt> template, in which <tt class="docutils literal"><span class="pre"><span class="Identifier">data</span></span></tt> and <tt class="docutils literal"><span class="pre"><span class="Identifier">parms</span></span></tt> parameters are <tt class="docutils literal"><span class="pre"><span class="Identifier">WideCString</span></span></tt>, and <tt class="docutils literal"><span class="pre"><span class="Identifier">newProcToExportA</span><span class="Punctuation">(</span><span class="Punctuation">)</span></span></tt> template, in which <tt class="docutils literal"><span class="pre"><span class="Identifier">data</span></span></tt> and <tt class="docutils literal"><span class="pre"><span class="Identifier">parms</span></span></tt> parameters are <tt class="docutils literal"><span class="pre"><span class="Identifier">cstring</span></span></tt>, which also add an exported procedure to dll, but at a lower level than <tt class="docutils literal"><span class="pre"><span class="Identifier">newProcToExport</span><span class="Punctuation">(</span><span class="Punctuation">)</span></span></tt>. However, if your choice is <tt class="docutils literal"><span class="pre"><span class="Identifier">newProcToExportW</span><span class="Punctuation">(</span><span class="Punctuation">)</span></span></tt> or <tt class="docutils literal"><span class="pre"><span class="Identifier">newProcToExportA</span><span class="Punctuation">(</span><span class="Punctuation">)</span></span></tt> you can also take advantage of safe copying for <tt class="docutils literal"><span class="pre"><span class="Identifier">data</span></span></tt> and <tt class="docutils literal"><span class="pre"><span class="Identifier">parms</span></span></tt> using <tt class="docutils literal"><span class="pre"><span class="Identifier">mToWideCStringAndCopy</span><span class="Punctuation">(</span><span class="Punctuation">)</span></span></tt> or <tt class="docutils literal"><span class="pre"><span class="Identifier">mToCStringAndCopy</span><span class="Punctuation">(</span><span class="Punctuation">)</span></span></tt>. Remembering that these last two procedures are only available if the <tt class="docutils literal"><span class="pre"><span class="Identifier">addLoadProc</span><span class="Punctuation">(</span><span class="Punctuation">)</span></span></tt> template is called in your code.</p>
<p>Finally, the <tt class="docutils literal"><span class="pre"><span class="Identifier">exportAllProcs</span><span class="Punctuation">(</span><span class="Punctuation">)</span></span></tt> template facilitates the process of exporting procedures to dll, as it generates the .def file with all the symbols that must be exported and links to the dll during the linking process.</p>
<p>Currently supported with the gcc, clang and vcc compilers, and the C and C++ backends. It is advised to use the most current version of Nim or the devel version.</p>
<p>Documentation used as a reference: <a class="reference external" href="https://www.mirc.com/help/html/dll.html">https://www.mirc.com/help/html/dll.html</a>.</p>

<h1><a class="toc-backref" id="basic-use" href="#basic-use">Basic Use</a></h1><p>This is a basic commented example:</p>
<p><pre class="listing"><span class="Comment"># test.nim</span>
<span class="Comment"># Import the mdlldk package.</span>
<span class="Keyword">import</span> <span class="Identifier">pkg</span><span class="Operator">/</span><span class="Identifier">mdlldk</span>

<span class="Comment"># Adds procedure LoadDll() and defines that the dll must not continue loaded</span>
<span class="Comment"># after use and the communication between the dll and mIRC must be by unicode</span>
<span class="Comment"># (WideCString).</span>
<span class="Identifier">addLoadProc</span><span class="Punctuation">(</span><span class="Identifier">false</span><span class="Punctuation">,</span> <span class="Identifier">true</span><span class="Punctuation">)</span><span class="Punctuation">:</span>
  <span class="Keyword">discard</span>

<span class="Comment"># Adds procedure UnloadDll() and defines that mIRC can unload the dll when it is</span>
<span class="Comment"># unused for ten minutes.</span>
<span class="Identifier">addUnloadProc</span><span class="Punctuation">(</span><span class="Identifier">RAllowUnload</span><span class="Punctuation">)</span><span class="Punctuation">:</span>
  <span class="Keyword">discard</span>

<span class="Comment"># Adds the `test` procedure which can be called from mIRC like this:</span>
<span class="Comment"># `/dll test.dll test`</span>
<span class="Identifier">newProcToExport</span><span class="Punctuation">(</span><span class="Identifier">test</span><span class="Punctuation">)</span><span class="Punctuation">:</span>
  <span class="Identifier">result</span><span class="Operator">.</span><span class="Identifier">outData</span> <span class="Operator">=</span> <span class="StringLit">&quot;echo -a Dll test made in Nim &quot;</span> <span class="Operator">&amp;</span> <span class="Identifier">NimVersion</span> <span class="Operator">&amp;</span> <span class="StringLit">&quot; for mIRC&quot;</span>
  <span class="Identifier">result</span><span class="Operator">.</span><span class="Identifier">ret</span> <span class="Operator">=</span> <span class="Identifier">RCommand</span>

<span class="Comment"># It must be added to the last line of your Nim code to correctly export all</span>
<span class="Comment"># symbols to the dll.</span>
<span class="Identifier">exportAllProcs</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
</pre> The above code should be compiled as follows:</p>
<p><tt class="docutils literal"><span class="pre"><span class="Identifier">nim</span> <span class="Identifier">c</span> <span class="Operator">--</span><span class="Identifier">app</span><span class="Punctuation">:</span><span class="Identifier">lib</span> <span class="Operator">-</span><span class="Identifier">d</span><span class="Punctuation">:</span><span class="Identifier">release</span> <span class="Operator">--</span><span class="Identifier">cpu</span><span class="Punctuation">:</span><span class="Identifier">i386</span> <span class="Operator">--</span><span class="Identifier">gc</span><span class="Punctuation">:</span><span class="Identifier">arc</span> <span class="Identifier">test</span><span class="Operator">.</span><span class="Identifier">nim</span></span></tt></p>
<p>To learn more about compiler options, visit <a class="reference external" href="https://nim-lang.org/docs/nimc.html">https://nim-lang.org/docs/nimc.html</a>.</p>
<p>In case you want to produce a smaller dll, you can add such switches:</p>
<p><tt class="docutils literal"><span class="pre"><span class="Identifier">nim</span> <span class="Identifier">c</span> <span class="Operator">--</span><span class="Identifier">app</span><span class="Punctuation">:</span><span class="Identifier">lib</span> <span class="Operator">-</span><span class="Identifier">d</span><span class="Punctuation">:</span><span class="Identifier">danger</span> <span class="Operator">-</span><span class="Identifier">d</span><span class="Punctuation">:</span><span class="Identifier">useMalloc</span> <span class="Operator">-</span><span class="Identifier">d</span><span class="Punctuation">:</span><span class="Identifier">strip</span> <span class="Operator">--</span><span class="Identifier">opt</span><span class="Punctuation">:</span><span class="Identifier">size</span> <span class="Operator">--</span><span class="Identifier">cpu</span><span class="Punctuation">:</span><span class="Identifier">i386</span> <span class="Operator">--</span><span class="Identifier">gc</span><span class="Punctuation">:</span><span class="Identifier">arc</span> <span class="Identifier">test</span><span class="Operator">.</span><span class="Identifier">nim</span></span></tt></p>
<p>With this last line my generated dll had only 17KB against 285KB of the other one, using the tdm64-gcc-10.3.0-2 compiler.</p>
</p>
  <div class="section" id="6">
<h1><a class="toc-backref" href="#6">Imports</a></h1>
<dl class="item">
<a class="reference external" href="mdlldk/types.html">mdlldk/types</a>
</dl></div>
<div class="section" id="12">
<h1><a class="toc-backref" href="#12">Procs</a></h1>
<dl class="item">

<div id="addProcToExport-procs-all">
<div id="addProcToExport,string,int">
<dt><pre><span class="Keyword">proc</span> <a href="#addProcToExport%2Cstring%2Cint"><span class="Identifier">addProcToExport</span></a><span class="Other">(</span><span class="Identifier">name</span><span class="Other">:</span> <span class="Identifier">string</span><span class="Other">;</span> <span class="Identifier">size</span><span class="Other">:</span> <span class="Identifier">int</span><span class="Other">)</span> {.<span class="Identifier">compileTime</span><span class="Other">,</span> <span><span class="Other pragmadots">...</span></span><span class="pragmawrap"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span>
    <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span>.}</pre></dt>
<dd>

<p>Add procedure <tt class="docutils literal"><span class="pre"><span class="Identifier">name</span></span></tt> to be exported to dll. The <tt class="docutils literal"><span class="pre"><span class="Identifier">size</span></span></tt> parameter indicates the total size in bytes of the procedure parameter types.</p>
<p><strong>Notes</strong></p>
<ul class="simple"><li>Procedures called by mIRC are 24 bytes long.</li>
<li>Don't forget to call the <tt class="docutils literal"><span class="pre"><span class="Identifier">exportAllProcs</span><span class="Punctuation">(</span><span class="Punctuation">)</span></span></tt> template at the end of your Nim code.</li>
</ul>

&nbsp;&nbsp;<a
href="https://github.com/rockcavera/nim-mdlldk/tree/main/src/mdlldk.nim#L150"
class="link-seesrc" target="_blank">Source</a>
&nbsp;&nbsp;<a href="https://github.com/rockcavera/nim-mdlldk/edit/main/src/mdlldk.nim#L150" class="link-seesrc" target="_blank" >Edit</a>

</dd>
</div>

</div>

</dl></div>
<div class="section" id="18">
<h1><a class="toc-backref" href="#18">Templates</a></h1>
<dl class="item">

<div id="addLoadProc-templates-all">
<div id="addLoadProc.t,bool,bool,untyped">
<dt><pre><span class="Keyword">template</span> <a href="#addLoadProc.t%2Cbool%2Cbool%2Cuntyped"><span class="Identifier">addLoadProc</span></a><span class="Other">(</span><span class="Identifier">keepLoaded</span><span class="Other">,</span> <span class="Identifier">strUnicode</span><span class="Other">:</span> <span class="Identifier">bool</span><span class="Other">;</span> <span class="Identifier">body</span><span class="Other">:</span> <span class="Identifier">untyped</span><span class="Other">)</span></pre></dt>
<dd>

Adds and exports the LoadDll() procedure, which is called when the dll is loaded in mIRC from version 5.8 onwards. In addition to adding the LoadDll() procedure, which captures and stores the information passed by mIRC, through the <tt class="docutils literal"><span class="pre"><span class="Identifier">LoadInfo</span></span></tt> object, it makes some corrections that facilitate the development of the dll, such as:<ul class="simple"><li>determine the total bytes value allocated to the <tt class="docutils literal"><span class="pre"><span class="Identifier">data</span></span></tt> and <tt class="docutils literal"><span class="pre"><span class="Identifier">parms</span></span></tt> parameters according to the mIRC version and string type (<tt class="docutils literal"><span class="pre"><span class="Identifier">WideCString</span></span></tt> or <tt class="docutils literal"><span class="pre"><span class="Identifier">cstring</span></span></tt>), since the <tt class="docutils literal"><span class="pre"><span class="Identifier">LoadInfo</span></span></tt> structure did not always pass such information.</li>
<li>to correct and determine the version passed in the <tt class="docutils literal"><span class="pre"><span class="Identifier">mVersion</span></span></tt> field, of the <tt class="docutils literal"><span class="pre"><span class="Identifier">LoadInfo</span></span></tt> object, because in some versions the major version of mIRC was passed as 0 and after version 6.21 mIRC started to adopt the filling with zero to the right of the minor version, which was not done previously and caused ambiguity between versions.</li>
</ul>
<p>It also adds several other Nim procedures to help with development. However, to have access to these added procedures it is necessary to call the <tt class="docutils literal"><span class="pre"><span class="Identifier">addLoadProc</span><span class="Punctuation">(</span><span class="Punctuation">)</span></span></tt> template on a line above the procedure usage.</p>
<p><strong>Template parameters</strong></p>
<ul class="simple"><li><tt class="docutils literal"><span class="pre"><span class="Identifier">keepLoaded</span></span></tt> sets the <tt class="docutils literal"><span class="pre"><span class="Identifier">mKeep</span></span></tt> field of the <tt class="docutils literal"><span class="pre"><span class="Identifier">LoadInfo</span></span></tt> object, if possible. See <a class="reference external" href="mdlldk/types.html#LoadInfo">LoadInfo</a>.</li>
<li><tt class="docutils literal"><span class="pre"><span class="Identifier">strUnicode</span></span></tt> sets the <tt class="docutils literal"><span class="pre"><span class="Identifier">mUnicode</span></span></tt> field of the <tt class="docutils literal"><span class="pre"><span class="Identifier">LoadInfo</span></span></tt> object, if possible. See <a class="reference external" href="mdlldk/types.html#LoadInfo">LoadInfo</a>.</li>
<li><tt class="docutils literal"><span class="pre"><span class="Identifier">body</span></span></tt> passes a code block that will be appended to the end of the LoadDll() procedure. If you didn't want to pass any code, use the <tt class="docutils literal"><span class="pre"><span class="Keyword">discard</span></span></tt> keyword.</li>
</ul>
<p><strong>Procedures added with the template</strong></p>
<p><pre class="listing"><span class="Keyword">proc</span> <span class="Identifier">mMajor</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">int</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">inline</span><span class="Operator">.</span><span class="Punctuation">}</span>
  <span class="Comment">## Returns the fixed major version of mIRC. Returns `-1` if unable to determine.</span>

<span class="Keyword">proc</span> <span class="Identifier">mMinor</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">int</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">inline</span><span class="Operator">.</span><span class="Punctuation">}</span>
  <span class="Comment">## Returns the fixed minor version of mIRC. Returns `-1` if unable to determine.</span>

<span class="Keyword">proc</span> <span class="Identifier">mBeta</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">int</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">inline</span><span class="Operator">.</span><span class="Punctuation">}</span>
  <span class="Comment">## Returns the beta version of mIRC. Returns `-1` if unable to determine and `0`</span>
  <span class="Comment">## if it is not a beta version.</span>

<span class="Keyword">proc</span> <span class="Identifier">mMaxBytes</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">int</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">inline</span><span class="Operator">.</span><span class="Punctuation">}</span>
  <span class="Comment">## Returns the size, in bytes, allocated in the pointers to the `data` and</span>
  <span class="Comment">## `parms` parameters.</span>

<span class="Keyword">proc</span> <span class="Identifier">mKeepLoaded</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">bool</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">inline</span><span class="Operator">.</span><span class="Punctuation">}</span>
  <span class="Comment">## Returns `true` if mIRC will keep the dll loaded after the call. If it returns</span>
  <span class="Comment">## `false` mIRC will unload the dll after the call.</span>

<span class="Keyword">proc</span> <span class="Identifier">mUnicode</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">bool</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">inline</span><span class="Operator">.</span><span class="Punctuation">}</span>
  <span class="Comment">## Returns `true` if the communication between mIRC and the dll will be via</span>
  <span class="Comment">## unicode strings. If it returns `false` the communication will be by ANSI</span>
  <span class="Comment">## C strings.</span>

<span class="Keyword">proc</span> <span class="Identifier">mMainWindowHandle</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">HWND</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">inline</span><span class="Operator">.</span><span class="Punctuation">}</span>
  <span class="Comment">## Returns a `HWND` for the identifier of the main window of mIRC. The `HWND`</span>
  <span class="Comment">## type is an alias for `int`.</span>

<span class="Keyword">proc</span> <span class="Identifier">mRawVersion</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">uint32</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">inline</span><span class="Operator">.</span><span class="Punctuation">}</span>
  <span class="Comment">## Returns a `uint32` with the raw version passed by mIRC, in the `mVersion`</span>
  <span class="Comment">## field, of the `LoadInfo` object, when loading the dll.</span>
  <span class="Comment">## **It is recommended to use the `mMajor()` and `mMinor()`.**</span>

<span class="Keyword">proc</span> <span class="Identifier">mToCStringAndCopy</span><span class="Punctuation">(</span><span class="Identifier">dest</span><span class="Punctuation">:</span> <span class="Identifier">pointer</span><span class="Operator">|</span><span class="Identifier">cstring</span><span class="Punctuation">,</span> <span class="Identifier">source</span><span class="Punctuation">:</span> <span class="Identifier">string</span><span class="Punctuation">)</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">inline</span><span class="Operator">.</span><span class="Punctuation">}</span>
  <span class="Comment">## Transforms `source` to `cstring` and copies it to `dest` up to the byte limit</span>
  <span class="Comment">## of `mMaxBytes()`.</span>

<span class="Keyword">proc</span> <span class="Identifier">mToWideCStringAndCopy</span><span class="Punctuation">(</span><span class="Identifier">dest</span><span class="Punctuation">:</span> <span class="Identifier">pointer</span><span class="Operator">|</span><span class="Identifier">WideCString</span><span class="Punctuation">,</span> <span class="Identifier">source</span><span class="Punctuation">:</span> <span class="Identifier">string</span><span class="Punctuation">)</span>
  <span class="Comment">## Transforms `source` into `WideCString` and copies it to `dest` up to the byte</span>
  <span class="Comment">## limit of `mMaxBytes()`.</span>
</pre></p>

&nbsp;&nbsp;<a
href="https://github.com/rockcavera/nim-mdlldk/tree/main/src/mdlldk.nim#L165"
class="link-seesrc" target="_blank">Source</a>
&nbsp;&nbsp;<a href="https://github.com/rockcavera/nim-mdlldk/edit/main/src/mdlldk.nim#L165" class="link-seesrc" target="_blank" >Edit</a>

</dd>
</div>

</div>

<div id="addUnloadProc-templates-all">
<div id="addUnloadProc.t,UnloadReturn,untyped">
<dt><pre><span class="Keyword">template</span> <a href="#addUnloadProc.t%2CUnloadReturn%2Cuntyped"><span class="Identifier">addUnloadProc</span></a><span class="Other">(</span><span class="Identifier">unused</span><span class="Other">:</span> <a href="mdlldk/types.html#UnloadReturn"><span class="Identifier">UnloadReturn</span></a><span class="Other">;</span> <span class="Identifier">body</span><span class="Other">:</span> <span class="Identifier">untyped</span><span class="Other">)</span></pre></dt>
<dd>

<p>Adds and exports the UnloadDll() procedure, which is called when mIRC unloads the dll from version 5.8 onwards.</p>
<p><strong>Template parameters</strong></p>
<ul class="simple"><li><tt class="docutils literal"><span class="pre"><span class="Identifier">unused</span></span></tt> determines if the dll will remain loaded or if it can be unloaded by mIRC when not in use for ten minutes. See <a class="reference external" href="mdlldk/types.html#UnloadReturn">UnloadReturn</a>.</li>
<li><tt class="docutils literal"><span class="pre"><span class="Identifier">body</span></span></tt> passes a code block that will be appended to the end of the UnloadDll() procedure. If you didn't want to pass any code, use the <tt class="docutils literal"><span class="pre"><span class="Keyword">discard</span></span></tt> keyword.</li>
</ul>
<p><strong>Notes</strong></p>
<ul class="simple"><li>The <tt class="docutils literal"><span class="pre"><span class="Identifier">result</span></span></tt> return variable is exposed and can be accessed and modified in <tt class="docutils literal"><span class="pre"><span class="Identifier">body</span></span></tt>.</li>
<li>The <tt class="docutils literal"><span class="pre"><span class="Identifier">mTimeout</span></span></tt> parameter is marked as <tt class="docutils literal"><span class="pre"><span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">inject</span><span class="Operator">.</span><span class="Punctuation">}</span></span></tt> and can be accessed in <tt class="docutils literal"><span class="pre"><span class="Identifier">body</span></span></tt>. Is of type <tt class="docutils literal"><span class="pre"><span class="Identifier">UnloadMode</span></span></tt>. See <a class="reference external" href="mdlldk/types.html#UnloadMode">UnloadMode</a>.</li>
</ul>

&nbsp;&nbsp;<a
href="https://github.com/rockcavera/nim-mdlldk/tree/main/src/mdlldk.nim#L372"
class="link-seesrc" target="_blank">Source</a>
&nbsp;&nbsp;<a href="https://github.com/rockcavera/nim-mdlldk/edit/main/src/mdlldk.nim#L372" class="link-seesrc" target="_blank" >Edit</a>

</dd>
</div>

</div>

<div id="exportAllProcs-templates-all">
<div id="exportAllProcs.t">
<dt><pre><span class="Keyword">template</span> <a href="#exportAllProcs.t"><span class="Identifier">exportAllProcs</span></a><span class="Other">(</span><span class="Other">)</span></pre></dt>
<dd>

This template must be called at the end of your Nim code so that the .def file can be created with the name of all the procedures that must be exported to the dll.
&nbsp;&nbsp;<a
href="https://github.com/rockcavera/nim-mdlldk/tree/main/src/mdlldk.nim#L159"
class="link-seesrc" target="_blank">Source</a>
&nbsp;&nbsp;<a href="https://github.com/rockcavera/nim-mdlldk/edit/main/src/mdlldk.nim#L159" class="link-seesrc" target="_blank" >Edit</a>

</dd>
</div>

</div>

<div id="newProcToExport-templates-all">
<div id="newProcToExport.t,untyped,untyped">
<dt><pre><span class="Keyword">template</span> <a href="#newProcToExport.t%2Cuntyped%2Cuntyped"><span class="Identifier">newProcToExport</span></a><span class="Other">(</span><span class="Identifier">procname</span><span class="Other">,</span> <span class="Identifier">body</span><span class="Other">:</span> <span class="Identifier">untyped</span><span class="Other">)</span></pre></dt>
<dd>

<p>This template facilitates the creation of a new procedure, with the name <tt class="docutils literal"><span class="pre"><span class="Identifier">procname</span></span></tt>, to export to dll, as it creates an abstraction layer that makes it possible to work in unicode as well as non-unicode mIRC, that is, it allows for a retroportability up to the mIRC version 5.6, when dll support was added.</p>
<p>Also, in this case the <tt class="docutils literal"><span class="pre"><span class="Identifier">data</span></span></tt> parameter is of type <tt class="docutils literal"><span class="pre"><span class="Identifier">string</span></span></tt>, and the <tt class="docutils literal"><span class="pre"><span class="Identifier">show</span></span></tt> and <tt class="docutils literal"><span class="pre"><span class="Identifier">nopause</span></span></tt> parameters are of type <tt class="docutils literal"><span class="pre"><span class="Identifier">bool</span></span></tt>, providing better compatibility with Nim.</p>
<p>There is also no need to manipulate pointers to copy command and parameter return into <tt class="docutils literal"><span class="pre"><span class="Identifier">data</span></span></tt> and <tt class="docutils literal"><span class="pre"><span class="Identifier">parms</span></span></tt>, as this is done in the abstraction layer and truncates them, if necessary, to avoid crashing mIRC when the strings are longer than the allocated pointers.</p>
<p><strong>Template parameters</strong></p>
<ul class="simple"><li><tt class="docutils literal"><span class="pre"><span class="Identifier">procname</span></span></tt> is the name of the procedure that will be exported to the dll.</li>
<li><tt class="docutils literal"><span class="pre"><span class="Identifier">body</span></span></tt> passes a code block that will be attached to the internal procedure that is called by the <tt class="docutils literal"><span class="pre"><span class="Identifier">procname</span></span></tt> procedure.</li>
</ul>
<p><strong>The internal procedure</strong></p>
<p><pre class="listing"><span class="Keyword">proc</span> <span class="Identifier">internalProc</span><span class="Punctuation">(</span><span class="Identifier">mWnd</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">inject</span><span class="Operator">.</span><span class="Punctuation">}</span><span class="Punctuation">,</span> <span class="Identifier">aWnd</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">inject</span><span class="Operator">.</span><span class="Punctuation">}</span><span class="Punctuation">:</span> <span class="Identifier">HWND</span><span class="Punctuation">,</span>
                  <span class="Identifier">data</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">inject</span><span class="Operator">.</span><span class="Punctuation">}</span><span class="Punctuation">:</span> <span class="Identifier">string</span><span class="Punctuation">,</span>
                  <span class="Identifier">show</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">inject</span><span class="Operator">.</span><span class="Punctuation">}</span><span class="Punctuation">,</span> <span class="Identifier">nopause</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">inject</span><span class="Operator">.</span><span class="Punctuation">}</span><span class="Punctuation">:</span> <span class="Identifier">bool</span><span class="Punctuation">)</span><span class="Punctuation">:</span>
                 <span class="Keyword">tuple</span><span class="Punctuation">[</span><span class="Identifier">ret</span><span class="Punctuation">:</span> <span class="Identifier">ProcReturn</span><span class="Punctuation">,</span> <span class="Identifier">outData</span><span class="Punctuation">,</span> <span class="Identifier">outParms</span><span class="Punctuation">:</span> <span class="Identifier">string</span><span class="Punctuation">]</span>
                 <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">gensym</span><span class="Operator">.</span><span class="Punctuation">}</span> <span class="Operator">=</span>
  <span class="Identifier">body</span>
</pre> Parameters marked with <tt class="docutils literal"><span class="pre"><span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">inject</span><span class="Operator">.</span><span class="Punctuation">}</span></span></tt> are accessed through <tt class="docutils literal"><span class="pre"><span class="Identifier">body</span></span></tt>. See below the description of each parameter. Already the return value of the internal procedure is <tt class="docutils literal"><span class="pre"><span class="Keyword">tuple</span><span class="Punctuation">[</span><span class="Identifier">ret</span><span class="Punctuation">:</span> <span class="Identifier">ProcReturn</span><span class="Punctuation">,</span> <span class="Identifier">outData</span><span class="Punctuation">,</span> <span class="Identifier">outParms</span><span class="Punctuation">:</span> <span class="Identifier">string</span><span class="Punctuation">]</span></span></tt> and will be explained below.</p>
<p><strong>Parameters accessible in body</strong></p>
<ul class="simple"><li><tt class="docutils literal"><span class="pre"><span class="Identifier">mWnd</span></span></tt> is the handle to the main mIRC window. It is of type <tt class="docutils literal"><span class="pre"><span class="Identifier">HWND</span></span></tt>, which is a <tt class="docutils literal"><span class="pre"><span class="Identifier">int</span></span></tt>.</li>
<li><tt class="docutils literal"><span class="pre"><span class="Identifier">aWnd</span></span></tt> is the handle of the window in which the command is being issued, this might not be the currently active window if the command is being called by a remote script. It is of type <tt class="docutils literal"><span class="pre"><span class="Identifier">HWND</span></span></tt>, which is a <tt class="docutils literal"><span class="pre"><span class="Identifier">int</span></span></tt>.</li>
<li><tt class="docutils literal"><span class="pre"><span class="Identifier">data</span></span></tt> is the information sent to the dll. It is of type <tt class="docutils literal"><span class="pre"><span class="Identifier">string</span></span></tt>.</li>
<li><tt class="docutils literal"><span class="pre"><span class="Identifier">show</span></span></tt> is <tt class="docutils literal"><span class="pre"><span class="Identifier">false</span></span></tt> if the . prefix was specified to make the command quiet, or <tt class="docutils literal"><span class="pre"><span class="Identifier">true</span></span></tt> otherwise. It is of type <tt class="docutils literal"><span class="pre"><span class="Identifier">bool</span></span></tt>.</li>
<li><tt class="docutils literal"><span class="pre"><span class="Identifier">nopause</span></span></tt> is <tt class="docutils literal"><span class="pre"><span class="Identifier">true</span></span></tt> if mIRC is in a critical routine and the dll must not do anything that pauses processing in mIRC, eg. the dll should not pop up a dialog. It is of type <tt class="docutils literal"><span class="pre"><span class="Identifier">bool</span></span></tt>.</li>
</ul>
<p><strong>The fields of the internal procedure's return tuple</strong></p>
<ul class="simple"><li><tt class="docutils literal"><span class="pre"><span class="Identifier">ret</span></span></tt> indicates what mIRC should do. See <a class="reference external" href="mdlldk/types.html#ProcReturn">ProcReturn</a>.</li>
<li><tt class="docutils literal"><span class="pre"><span class="Identifier">outData</span></span></tt> can be filled in with a command you want mIRC to perform if any.</li>
<li><tt class="docutils literal"><span class="pre"><span class="Identifier">outParms</span></span></tt> can be filled in with the parameters you want mIRC to use when performing the command passed in <tt class="docutils literal"><span class="pre"><span class="Identifier">outData</span></span></tt>.</li>
</ul>

&nbsp;&nbsp;<a
href="https://github.com/rockcavera/nim-mdlldk/tree/main/src/mdlldk.nim#L402"
class="link-seesrc" target="_blank">Source</a>
&nbsp;&nbsp;<a href="https://github.com/rockcavera/nim-mdlldk/edit/main/src/mdlldk.nim#L402" class="link-seesrc" target="_blank" >Edit</a>

</dd>
</div>

</div>

<div id="newProcToExportA-templates-all">
<div id="newProcToExportA.t,untyped,untyped">
<dt><pre><span class="Keyword">template</span> <a href="#newProcToExportA.t%2Cuntyped%2Cuntyped"><span class="Identifier">newProcToExportA</span></a><span class="Other">(</span><span class="Identifier">procname</span><span class="Other">,</span> <span class="Identifier">body</span><span class="Other">:</span> <span class="Identifier">untyped</span><span class="Other">)</span></pre></dt>
<dd>

<p>This template makes it easy to create a new procedure to export to the dll, but at a lower level than <tt class="docutils literal"><span class="pre"><span class="Identifier">newProcToExport</span><span class="Punctuation">(</span><span class="Punctuation">)</span></span></tt>. In this case the <tt class="docutils literal"><span class="pre"><span class="Identifier">data</span></span></tt> and <tt class="docutils literal"><span class="pre"><span class="Identifier">parms</span></span></tt> parameters are of type <tt class="docutils literal"><span class="pre"><span class="Identifier">cstring</span></span></tt>.</p>
<p><strong>The `procname`</strong></p>
<p><pre class="listing"><span class="Keyword">proc</span> <span class="Identifier">procname</span><span class="Punctuation">(</span><span class="Identifier">mWnd</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">inject</span><span class="Operator">.</span><span class="Punctuation">}</span><span class="Punctuation">,</span> <span class="Identifier">aWnd</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">inject</span><span class="Operator">.</span><span class="Punctuation">}</span><span class="Punctuation">:</span> <span class="Identifier">HWND</span><span class="Punctuation">,</span>
              <span class="Identifier">data</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">inject</span><span class="Operator">.</span><span class="Punctuation">}</span><span class="Punctuation">,</span> <span class="Identifier">parms</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">inject</span><span class="Operator">.</span><span class="Punctuation">}</span><span class="Punctuation">:</span> <span class="Identifier">cstring</span><span class="Punctuation">,</span>
              <span class="Identifier">show</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">inject</span><span class="Operator">.</span><span class="Punctuation">}</span><span class="Punctuation">,</span> <span class="Identifier">nopause</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">inject</span><span class="Operator">.</span><span class="Punctuation">}</span><span class="Punctuation">:</span> <span class="Identifier">BOOL</span><span class="Punctuation">)</span><span class="Punctuation">:</span>
             <span class="Identifier">ProcReturn</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">stdcall</span><span class="Punctuation">,</span> <span class="Identifier">exportc</span><span class="Operator">.</span><span class="Punctuation">}</span> <span class="Operator">=</span>
  <span class="Identifier">body</span>
</pre> Parameters marked with <tt class="docutils literal"><span class="pre"><span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">inject</span><span class="Operator">.</span><span class="Punctuation">}</span></span></tt> are accessed through <tt class="docutils literal"><span class="pre"><span class="Identifier">body</span></span></tt>. See below the description of each parameter. Already the return value is <tt class="docutils literal"><span class="pre"><span class="Identifier">ProcReturn</span></span></tt>. See <a class="reference external" href="mdlldk/types.html#ProcReturn">ProcReturn</a>.</p>
<p><strong>`procname` parameters</strong></p>
<ul class="simple"><li><tt class="docutils literal"><span class="pre"><span class="Identifier">mWnd</span></span></tt> is the handle to the main mIRC window. It is of type <tt class="docutils literal"><span class="pre"><span class="Identifier">HWND</span></span></tt>, which is a <tt class="docutils literal"><span class="pre"><span class="Identifier">int</span></span></tt>.</li>
<li><tt class="docutils literal"><span class="pre"><span class="Identifier">aWnd</span></span></tt> is the handle of the window in which the command is being issued, this might not be the currently active window if the command is being called by a remote script. It is of type <tt class="docutils literal"><span class="pre"><span class="Identifier">HWND</span></span></tt>, which is a <tt class="docutils literal"><span class="pre"><span class="Identifier">int</span></span></tt>.</li>
<li><tt class="docutils literal"><span class="pre"><span class="Identifier">data</span></span></tt> is the information that you wish to send to the dll. On return, the dll can fill this variable with the command it wants mIRC to perform if any. It is of type <tt class="docutils literal"><span class="pre"><span class="Identifier">cstring</span></span></tt>.</li>
<li><tt class="docutils literal"><span class="pre"><span class="Identifier">parms</span></span></tt> is filled by the dll on return with parameters that it wants mIRC to use when performing the command that it returns in the <tt class="docutils literal"><span class="pre"><span class="Identifier">data</span></span></tt> variable. It is of type <tt class="docutils literal"><span class="pre"><span class="Identifier">cstring</span></span></tt>.</li>
<li><tt class="docutils literal"><span class="pre"><span class="Identifier">show</span></span></tt> is FALSE (0) if the . prefix was specified to make the command quiet, or TRUE (1) otherwise. It is of type <tt class="docutils literal"><span class="pre"><span class="Identifier">BOOL</span></span></tt>, which is a <tt class="docutils literal"><span class="pre"><span class="Identifier">cint</span></span></tt>.</li>
<li><tt class="docutils literal"><span class="pre"><span class="Identifier">nopause</span></span></tt> is TRUE (1) if mIRC is in a critical routine and the dll must not do anything that pauses processing in mIRC, eg. the dll should not pop up a dialog. It is of type <tt class="docutils literal"><span class="pre"><span class="Identifier">BOOL</span></span></tt>, which is a <tt class="docutils literal"><span class="pre"><span class="Identifier">cint</span></span></tt>.</li>
</ul>

&nbsp;&nbsp;<a
href="https://github.com/rockcavera/nim-mdlldk/tree/main/src/mdlldk.nim#L527"
class="link-seesrc" target="_blank">Source</a>
&nbsp;&nbsp;<a href="https://github.com/rockcavera/nim-mdlldk/edit/main/src/mdlldk.nim#L527" class="link-seesrc" target="_blank" >Edit</a>

</dd>
</div>

</div>

<div id="newProcToExportW-templates-all">
<div id="newProcToExportW.t,untyped,untyped">
<dt><pre><span class="Keyword">template</span> <a href="#newProcToExportW.t%2Cuntyped%2Cuntyped"><span class="Identifier">newProcToExportW</span></a><span class="Other">(</span><span class="Identifier">procname</span><span class="Other">,</span> <span class="Identifier">body</span><span class="Other">:</span> <span class="Identifier">untyped</span><span class="Other">)</span></pre></dt>
<dd>

<p>This template makes it easy to create a new procedure to export to the dll, but at a lower level than <tt class="docutils literal"><span class="pre"><span class="Identifier">newProcToExport</span><span class="Punctuation">(</span><span class="Punctuation">)</span></span></tt>. In this case the <tt class="docutils literal"><span class="pre"><span class="Identifier">data</span></span></tt> and <tt class="docutils literal"><span class="pre"><span class="Identifier">parms</span></span></tt> parameters are of type <tt class="docutils literal"><span class="pre"><span class="Identifier">WideCString</span></span></tt>.</p>
<p><strong>The `procname` procedure</strong></p>
<p><pre class="listing"><span class="Keyword">proc</span> <span class="Identifier">procname</span><span class="Punctuation">(</span><span class="Identifier">mWnd</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">inject</span><span class="Operator">.</span><span class="Punctuation">}</span><span class="Punctuation">,</span> <span class="Identifier">aWnd</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">inject</span><span class="Operator">.</span><span class="Punctuation">}</span><span class="Punctuation">:</span> <span class="Identifier">HWND</span><span class="Punctuation">,</span>
              <span class="Identifier">data</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">inject</span><span class="Operator">.</span><span class="Punctuation">}</span><span class="Punctuation">,</span> <span class="Identifier">parms</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">inject</span><span class="Operator">.</span><span class="Punctuation">}</span><span class="Punctuation">:</span> <span class="Identifier">WideCString</span><span class="Punctuation">,</span>
              <span class="Identifier">show</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">inject</span><span class="Operator">.</span><span class="Punctuation">}</span><span class="Punctuation">,</span> <span class="Identifier">nopause</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">inject</span><span class="Operator">.</span><span class="Punctuation">}</span><span class="Punctuation">:</span> <span class="Identifier">BOOL</span><span class="Punctuation">)</span><span class="Punctuation">:</span>
             <span class="Identifier">ProcReturn</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">stdcall</span><span class="Punctuation">,</span> <span class="Identifier">exportc</span><span class="Operator">.</span><span class="Punctuation">}</span> <span class="Operator">=</span>
  <span class="Identifier">body</span>
</pre> Parameters marked with <tt class="docutils literal"><span class="pre"><span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">inject</span><span class="Operator">.</span><span class="Punctuation">}</span></span></tt> are accessed through <tt class="docutils literal"><span class="pre"><span class="Identifier">body</span></span></tt>. See below the description of each parameter. Already the return value is <tt class="docutils literal"><span class="pre"><span class="Identifier">ProcReturn</span></span></tt>. See <a class="reference external" href="mdlldk/types.html#ProcReturn">ProcReturn</a>.</p>
<p><strong>`procname` parameters</strong></p>
<ul class="simple"><li><tt class="docutils literal"><span class="pre"><span class="Identifier">mWnd</span></span></tt> is the handle to the main mIRC window. It is of type <tt class="docutils literal"><span class="pre"><span class="Identifier">HWND</span></span></tt>, which is a <tt class="docutils literal"><span class="pre"><span class="Identifier">int</span></span></tt>.</li>
<li><tt class="docutils literal"><span class="pre"><span class="Identifier">aWnd</span></span></tt> is the handle of the window in which the command is being issued, this might not be the currently active window if the command is being called by a remote script. It is of type <tt class="docutils literal"><span class="pre"><span class="Identifier">HWND</span></span></tt>, which is a <tt class="docutils literal"><span class="pre"><span class="Identifier">int</span></span></tt>.</li>
<li><tt class="docutils literal"><span class="pre"><span class="Identifier">data</span></span></tt> is the information that you wish to send to the dll. On return, the dll can fill this variable with the command it wants mIRC to perform if any. It is of type <tt class="docutils literal"><span class="pre"><span class="Identifier">WideCString</span></span></tt>.</li>
<li><tt class="docutils literal"><span class="pre"><span class="Identifier">parms</span></span></tt> is filled by the dll on return with parameters that it wants mIRC to use when performing the command that it returns in the <tt class="docutils literal"><span class="pre"><span class="Identifier">data</span></span></tt> variable. It is of type <tt class="docutils literal"><span class="pre"><span class="Identifier">WideCString</span></span></tt>.</li>
<li><tt class="docutils literal"><span class="pre"><span class="Identifier">show</span></span></tt> is FALSE (0) if the . prefix was specified to make the command quiet, or TRUE (1) otherwise. It is of type <tt class="docutils literal"><span class="pre"><span class="Identifier">BOOL</span></span></tt>, which is a <tt class="docutils literal"><span class="pre"><span class="Identifier">cint</span></span></tt>.</li>
<li><tt class="docutils literal"><span class="pre"><span class="Identifier">nopause</span></span></tt> is TRUE (1) if mIRC is in a critical routine and the dll must not do anything that pauses processing in mIRC, eg. the dll should not pop up a dialog. It is of type <tt class="docutils literal"><span class="pre"><span class="Identifier">BOOL</span></span></tt>, which is a <tt class="docutils literal"><span class="pre"><span class="Identifier">cint</span></span></tt>.</li>
</ul>

&nbsp;&nbsp;<a
href="https://github.com/rockcavera/nim-mdlldk/tree/main/src/mdlldk.nim#L488"
class="link-seesrc" target="_blank">Source</a>
&nbsp;&nbsp;<a href="https://github.com/rockcavera/nim-mdlldk/edit/main/src/mdlldk.nim#L488" class="link-seesrc" target="_blank" >Edit</a>

</dd>
</div>

</div>

</dl></div>
<div class="section" id="19">
<h1><a class="toc-backref" href="#19">Exports</a></h1>
<dl class="item">
<a href="mdlldk/types.html#ProcReturn"><span class="Identifier">ProcReturn</span></a>, <a href="mdlldk/types.html#BOOL"><span class="Identifier">BOOL</span></a>, <a href="mdlldk/types.html#UnloadReturn"><span class="Identifier">UnloadReturn</span></a>, <a href="mdlldk/types.html#LoadInfo"><span class="Identifier">LoadInfo</span></a>, <a href="mdlldk/types.html#HWND"><span class="Identifier">HWND</span></a>, <a href="mdlldk/types.html#UnloadMode"><span class="Identifier">UnloadMode</span></a>
</dl></div>

  </div>
</div>

    <div class="row">
      <div class="twelve-columns footer">
        <span class="nim-sprite"></span>
        <br/>
        <small style="color: var(--hint);">Made with Nim. Generated: 2022-02-09 21:20:47 UTC</small>
      </div>
    </div>
  </div>
</div>

</body>
</html>
